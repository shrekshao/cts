{"version":3,"sources":["../../src/webgpu/examples.spec.ts"],"names":["description","makeTestGroup","GPUTest","g","test","fn","t","unimplemented","desc","expect","shouldThrow","TypeError","shouldReject","Promise","reject","paramsSimple","x","y","params","_result","u","combineWithParams","beginSubcases","paramsSubcasesOnly","queue","onSubmittedWorkDone","undefined","data","Uint32Array","src","device","createBuffer","mappedAtCreation","size","usage","GPUBufferUsage","COPY_SRC","COPY_DST","getMappedRange","set","unmap","expectGPUBufferValuesEqual","combine","textureCompressionBC","selectDeviceOrSkipTestCase","shouldError","expectGPUError","createTexture","format","GPUTextureUsage","SAMPLED","textureCompressionETC"],"mappings":"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","sourcesContent":["export const description = `\nExamples of writing CTS tests with various features.\n\nStart here when looking for examples of basic framework usage.\n`;\n\nimport { makeTestGroup } from '../common/framework/test_group.js';\n\nimport { GPUTest } from './gpu_test.js';\n\n// To run these tests in the standalone runner, run `npm start` then open:\n// - http://localhost:XXXX/standalone/?runnow=1&q=webgpu:examples:*\n// To run in WPT, copy/symlink the out-wpt/ directory as the webgpu/ directory in WPT, then open:\n// - (wpt server url)/webgpu/cts.html?q=webgpu:examples:\n//\n// Tests here can be run individually or in groups:\n// - ?q=webgpu:examples:basic,async:\n// - ?q=webgpu:examples:basic,async:*\n// - ?q=webgpu:examples:basic,*\n// - ?q=webgpu:examples:*\n\nexport const g = makeTestGroup(GPUTest);\n\n// Note: spaces in test names are replaced with underscores: webgpu:examples:test_name=\ng.test('test_name').fn(t => {});\n\ng.test('not_implemented_yet,without_plan').unimplemented();\ng.test('not_implemented_yet,with_plan')\n  .desc(\n    `\nPlan for this test. What it tests. Summary of how it tests that functionality.\n- Description of cases, by describing parameters {a, b, c}\n- x= more parameters {x, y, z}\n`\n  )\n  .unimplemented();\n\ng.test('basic').fn(t => {\n  t.expect(true);\n  t.expect(true, 'true should be true');\n\n  t.shouldThrow(\n    // The expected '.name' of the thrown error.\n    'TypeError',\n    // This function is run inline inside shouldThrow, and is expected to throw.\n    () => {\n      throw new TypeError();\n    },\n    // Log message.\n    'function should throw Error'\n  );\n});\n\ng.test('basic,async').fn(async t => {\n  // shouldReject must be awaited to ensure it can wait for the promise before the test ends.\n  t.shouldReject(\n    // The expected '.name' of the thrown error.\n    'TypeError',\n    // Promise expected to reject.\n    Promise.reject(new TypeError()),\n    // Log message.\n    'Promise.reject should reject'\n  );\n\n  // Promise can also be an IIFE.\n  t.shouldReject(\n    'TypeError',\n    (async () => {\n      throw new TypeError();\n    })(),\n    'Promise.reject should reject'\n  );\n});\n\ng.test('basic,plain_cases')\n  .desc(\n    `\nA test can be parameterized with a simple array of objects using .paramsSimple([ ... ]).\nEach such instance of the test is a \"case\".\n\nIn this example, the following cases are generated (identified by their \"query string\"),\neach with just one subcase:\n  - webgpu:examples:basic,cases:x=2;y=2      runs 1 subcase, with t.params set to:\n      - { x:   2, y:   2 }\n  - webgpu:examples:basic,cases:x=-10;y=-10  runs 1 subcase, with t.params set to:\n      - { x: -10, y: -10 }\n  `\n  )\n  .paramsSimple([\n    { x: 2, y: 2 }, //\n    { x: -10, y: -10 },\n  ])\n  .fn(t => {\n    t.expect(t.params.x === t.params.y);\n  });\n\ng.test('basic,plain_cases_private')\n  .desc(\n    `\nParameters can be public (\"x\", \"y\") which means they're part of the case name.\nThey can also be private by starting with an underscore (\"_result\"), which passes\nthem into the test but does not make them part of the case name:\n\nIn this example, the following cases are generated, each with just one subcase:\n  - webgpu:examples:basic,cases:x=2;y=4     runs 1 subcase, with t.params set to:\n      - { x:   2, y:  4, _result: 6 }\n  - webgpu:examples:basic,cases:x=-10;y=18  runs 1 subcase, with t.params set to:\n      - { x: -10, y: 18, _result: 8 }\n  `\n  )\n  .paramsSimple([\n    { x: 2, y: 4, _result: 6 }, //\n    { x: -10, y: 18, _result: 8 },\n  ])\n  .fn(t => {\n    t.expect(t.params.x + t.params.y === t.params._result);\n  });\n// (note the blank comment above to enforce newlines on autoformat)\n\ng.test('basic,builder_cases')\n  .desc(\n    `\nA \"CaseParamsBuilder\" or \"SubcaseParamsBuilder\" can be passed to .params() instead.\nThe params builder provides facilities for generating tests combinatorially (by cartesian\nproduct). For convenience, the \"unit\" CaseParamsBuilder is passed as an argument (\"u\" below).\n\nIn this example, the following cases are generated, each with just one subcase:\n  - webgpu:examples:basic,cases:x=1,y=1  runs 1 subcase, with t.params set to:\n      - { x: 1, y: 1 }\n  - webgpu:examples:basic,cases:x=1,y=2  runs 1 subcase, with t.params set to:\n      - { x: 1, y: 2 }\n  - webgpu:examples:basic,cases:x=2,y=1  runs 1 subcase, with t.params set to:\n      - { x: 2, y: 1 }\n  - webgpu:examples:basic,cases:x=2,y=2  runs 1 subcase, with t.params set to:\n      - { x: 2, y: 2 }\n  `\n  )\n  .params(u =>\n    u //\n      .combineWithParams([{ x: 1 }, { x: 2 }])\n      .combineWithParams([{ y: 1 }, { y: 2 }])\n  )\n  .fn(() => {});\n\ng.test('basic,builder_cases_subcases')\n  .desc(\n    `\nEach case sub-parameterized using .beginSubcases().\nEach such instance of the test is a \"subcase\", which cannot be run independently of other\nsubcases. It is somewhat like wrapping the entire fn body in a for-loop.\n\nIn this example, the following cases are generated:\n  - webgpu:examples:basic,cases:x=1      runs 2 subcases, with t.params set to:\n      - { x: 1, y: 1 }\n      - { x: 1, y: 2 }\n  - webgpu:examples:basic,cases:x=2      runs 2 subcases, with t.params set to:\n      - { x: 2, y: 1 }\n      - { x: 2, y: 2 }\n  `\n  )\n  .params(u =>\n    u //\n      .combineWithParams([{ x: 1 }, { x: 2 }])\n      .beginSubcases()\n      .combineWithParams([{ y: 1 }, { y: 2 }])\n  )\n  .fn(() => {});\n\ng.test('basic,builder_subcases')\n  .desc(\n    `\nIn this example, the following single case is generated:\n  - webgpu:examples:basic,cases:         runs 4 subcases, with t.params set to:\n      - { x: 1, y: 1 }\n      - { x: 1, y: 2 }\n      - { x: 2, y: 1 }\n      - { x: 2, y: 2 }\n  `\n  )\n  .params(u =>\n    u //\n      .beginSubcases()\n      .combineWithParams([{ x: 1 }, { x: 2 }])\n      .combineWithParams([{ y: 1 }, { y: 2 }])\n  )\n  .fn(() => {});\n\ng.test('basic,builder_subcases_short')\n  .desc(\n    `\nAs a shorthand, .paramsSubcasesOnly() can be used.\n\nIn this example, the following single case is generated:\n  - webgpu:examples:basic,cases:         runs 4 subcases, with t.params set to:\n      - { x: 1, y: 1 }\n      - { x: 1, y: 2 }\n      - { x: 2, y: 1 }\n      - { x: 2, y: 2 }\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u //\n      .combineWithParams([{ x: 1 }, { x: 2 }])\n      .combineWithParams([{ y: 1 }, { y: 2 }])\n  )\n  .fn(() => {});\n\ng.test('gpu,async').fn(async t => {\n  const x = await t.queue.onSubmittedWorkDone();\n  t.expect(x === undefined);\n});\n\ng.test('gpu,buffers').fn(async t => {\n  const data = new Uint32Array([0, 1234, 0]);\n  const src = t.device.createBuffer({\n    mappedAtCreation: true,\n    size: 12,\n    usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST,\n  });\n  new Uint32Array(src.getMappedRange()).set(data);\n  src.unmap();\n\n  // Use the expectContents helper to check the actual contents of a GPUBuffer.\n  // Like shouldReject, it must be awaited.\n  t.expectGPUBufferValuesEqual(src, data);\n});\n\n// One of the following two tests should be skipped on most platforms.\n\ng.test('gpu,with_texture_compression,bc')\n  .desc(\n    `Example of a test using a device descriptor.\nTests that a BC format passes validation iff the feature is enabled.`\n  )\n  .params(u => u.combine('textureCompressionBC', [false, true]))\n  .fn(async t => {\n    const { textureCompressionBC } = t.params;\n\n    if (textureCompressionBC) {\n      await t.selectDeviceOrSkipTestCase('texture-compression-bc');\n    }\n\n    const shouldError = !textureCompressionBC;\n    t.expectGPUError(\n      'validation',\n      () => {\n        t.device.createTexture({\n          format: 'bc1-rgba-unorm',\n          size: [4, 4, 1],\n          usage: GPUTextureUsage.SAMPLED,\n        });\n      },\n      shouldError\n    );\n  });\n\ng.test('gpu,with_texture_compression,etc')\n  .desc(\n    `Example of a test using a device descriptor.\n\nTODO: Test that an ETC format passes validation iff the feature is enabled.`\n  )\n  .params(u => u.combine('textureCompressionETC', [false, true]))\n  .fn(async t => {\n    const { textureCompressionETC } = t.params;\n\n    if (textureCompressionETC) {\n      await t.selectDeviceOrSkipTestCase('texture-compression-etc' as GPUFeatureName);\n    }\n\n    // TODO: Should actually test createTexture with an ETC format here.\n  });\n"],"file":"examples.spec.js"}