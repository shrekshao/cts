{"version":3,"file":"shareable_types.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","kTestTypes","test","desc","params","u","combine","fn","t","storageClass","type","code","expectation","indexOf","startsWith","expectCompileResult"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/shareable_types.spec.ts"],"sourcesContent":["export const description = `\nPositive and negative validation tests for variable and const.\n\nTODO: Find a better way to test arrays than using a single arbitrary size. [1]\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kTestTypes = [\n  'f32',\n  'i32',\n  'u32',\n  'bool',\n  'vec2<f32>',\n  'vec2<i32>',\n  'vec2<u32>',\n  'vec2<bool>',\n  'vec3<f32>',\n  'vec3<i32>',\n  'vec3<u32>',\n  'vec3<bool>',\n  'vec4<f32>',\n  'vec4<i32>',\n  'vec4<u32>',\n  'vec4<bool>',\n  'mat2x2<f32>',\n  'mat2x3<f32>',\n  'mat2x4<f32>',\n  'mat3x2<f32>',\n  'mat3x3<f32>',\n  'mat3x4<f32>',\n  'mat4x2<f32>',\n  'mat4x3<f32>',\n  'mat4x4<f32>',\n  // [1]: 12 is a random number here. find a solution to replace it.\n  'array<f32, 12>',\n  'array<i32, 12>',\n  'array<u32, 12>',\n  'array<bool, 12>',\n] as const;\n\ng.test('io_shareable_type')\n  .desc(\n    `\n  The following types are IO-shareable:\n  - numeric scalar types\n  - numeric vector types\n  - Matrix Types\n  - Array Types if its element type is IO-shareable, and the array is not runtime-sized\n  - Structure Types if all its members are IO-shareable\n\n  As a result these are not IO-shareable:\n  - boolean\n  - vector of booleans\n  - array of booleans\n  - matrix of booleans\n  - array runtime sized -> cannot be used outside of a struct, so no cts for this\n  - struct with bool component\n  - struct with runtime array\n\n  Control case: 'private' is used to make sure when only the storage class changes, the shader\n  becomes invalid and nothing else is wrong.\n  TODO: add test for structs:\n  - struct with bool component\n  - struct with runtime array`\n  )\n  .params(u => u.combine('storageClass', ['in', 'out', 'private']).combine('type', kTestTypes))\n  .fn(t => {\n    const { storageClass, type } = t.params;\n\n    let code;\n    if (`${storageClass}` === 'in') {\n      code = `\n        struct MyInputs {\n          @location(0) @interpolate(flat) a : ${type}\n        };\n\n        @fragment\n        fn main(inputs : MyInputs) {\n        }\n      `;\n    } else if (`${storageClass}` === 'out') {\n      code = `\n        struct MyOutputs {\n          @location(0) a : ${type}\n        };\n\n        @fragment\n        fn main() -> MyOutputs {\n          return MyOutputs();\n        }\n      `;\n    } else {\n      code = `\n      var<${storageClass}> a : ${type} = ${type}();\n\n      @fragment\n      fn main() {\n      }\n      `;\n    }\n\n    const expectation =\n      storageClass === 'private' ||\n      (type.indexOf('bool') === -1 && !type.startsWith('mat') && !type.startsWith('array'));\n    t.expectCompileResult(expectation, code);\n  });\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,oBAAoB,CAAC;;AAEpD,MAAME,UAAU,GAAG;AACjB,KAAK;AACL,KAAK;AACL,KAAK;AACL,MAAM;AACN,WAAW;AACX,WAAW;AACX,WAAW;AACX,YAAY;AACZ,WAAW;AACX,WAAW;AACX,WAAW;AACX,YAAY;AACZ,WAAW;AACX,WAAW;AACX,WAAW;AACX,YAAY;AACZ,aAAa;AACb,aAAa;AACb,aAAa;AACb,aAAa;AACb,aAAa;AACb,aAAa;AACb,aAAa;AACb,aAAa;AACb,aAAa;AACb;AACA,gBAAgB;AAChB,gBAAgB;AAChB,gBAAgB;AAChB,iBAAiB,CACT;;;AAEVD,CAAC,CAACE,IAAI,CAAC,mBAAmB,CAAC;AACxBC,IAAI;AACF;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,CAC3B;;AACAC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,cAAc,EAAE,CAAC,IAAI,EAAE,KAAK,EAAE,SAAS,CAAC,CAAC,CAACA,OAAO,CAAC,MAAM,EAAEL,UAAU,CAAC,CAAC;AAC5FM,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,YAAY,EAAEC,IAAI,CAAC,CAAC,GAAGF,CAAC,CAACJ,MAAM;;EAEvC,IAAIO,IAAI;EACR,IAAK,GAAEF,YAAa,EAAC,KAAK,IAAI,EAAE;IAC9BE,IAAI,GAAI;AACd;AACA,gDAAgDD,IAAK;AACrD;AACA;AACA;AACA;AACA;AACA,OAAO;EACH,CAAC,MAAM,IAAK,GAAED,YAAa,EAAC,KAAK,KAAK,EAAE;IACtCE,IAAI,GAAI;AACd;AACA,6BAA6BD,IAAK;AAClC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;EACH,CAAC,MAAM;IACLC,IAAI,GAAI;AACd,YAAYF,YAAa,SAAQC,IAAK,MAAKA,IAAK;AAChD;AACA;AACA;AACA;AACA,OAAO;EACH;;EAEA,MAAME,WAAW;EACfH,YAAY,KAAK,SAAS;EACzBC,IAAI,CAACG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAACH,IAAI,CAACI,UAAU,CAAC,KAAK,CAAC,IAAI,CAACJ,IAAI,CAACI,UAAU,CAAC,OAAO,CAAE;EACvFN,CAAC,CAACO,mBAAmB,CAACH,WAAW,EAAED,IAAI,CAAC;AAC1C,CAAC,CAAC"}