{"version":3,"file":"ImageBitmap.spec.js","names":["description","makeTestGroup","kTextureFormatInfo","kValidTextureFormatsForCopyE2T","CopyToTextureUtils","TexelView","kColors","Red","R","G","B","A","Green","Blue","Black","White","SemitransparentWhite","kTestColorsOpaque","kTestColorsAll","makeTestColorsTexelView","testColors","format","width","height","premultiplied","flipY","fromTexelsAsColors","coords","y","pixelPos","x","currentPixel","length","g","test","desc","params","u","combine","beginSubcases","fn","t","alpha","orientation","dstColorFormat","dstPremultiplied","srcDoFlipYDuringCopy","texelViewSource","imageData","ImageData","writeTextureData","data","bytesPerRow","rowsPerImage","subrectOrigin","subrectSize","imageBitmap","createImageBitmap","premultiplyAlpha","imageOrientation","dst","device","createTexture","size","usage","GPUTextureUsage","COPY_DST","COPY_SRC","RENDER_ATTACHMENT","expFormat","baseFormat","expectFlipped","texelViewExpected","doTestAndCheckResult","source","origin","texture","colorSpace","premultipliedAlpha","depthOrArrayLayers","maxDiffULPsForFloatFormat","maxDiffULPsForNormFormat","imageCanvas","document","createElement","OffscreenCanvas","skip","imageCanvasContext","getContext","putImageData"],"sources":["../../../../src/webgpu/web_platform/copyToTexture/ImageBitmap.spec.ts"],"sourcesContent":["export const description = `\ncopyExternalImageToTexture from ImageBitmaps created from various sources.\n\nTODO: Test ImageBitmap generated from all possible ImageBitmapSource, relevant ImageBitmapOptions\n    (https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#images-2)\n    and various source filetypes and metadata (weird dimensions, EXIF orientations, video rotations\n    and visible/crop rectangles, etc. (In theory these things are handled inside createImageBitmap,\n    but in theory could affect the internal representation of the ImageBitmap.)\n\nTODO: Test zero-sized copies from all sources (just make sure params cover it) (e.g. 0x0, 0x4, 4x0).\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport {\n  kTextureFormatInfo,\n  kValidTextureFormatsForCopyE2T,\n  EncodableTextureFormat,\n} from '../../capability_info.js';\nimport { CopyToTextureUtils } from '../../util/copy_to_texture.js';\nimport { PerTexelComponent } from '../../util/texture/texel_data.js';\nimport { TexelView } from '../../util/texture/texel_view.js';\n\ntype TestColor = PerTexelComponent<number>;\n// None of the dst texture format is 'uint' or 'sint', so we can always use float value.\nconst kColors = {\n  Red: { R: 1.0, G: 0.0, B: 0.0, A: 1.0 },\n  Green: { R: 0.0, G: 1.0, B: 0.0, A: 1.0 },\n  Blue: { R: 0.0, G: 0.0, B: 1.0, A: 1.0 },\n  Black: { R: 0.0, G: 0.0, B: 0.0, A: 1.0 },\n  White: { R: 1.0, G: 1.0, B: 1.0, A: 1.0 },\n  SemitransparentWhite: { R: 1.0, G: 1.0, B: 1.0, A: 0.6 },\n} as const;\nconst kTestColorsOpaque = [\n  kColors.Red,\n  kColors.Green,\n  kColors.Blue,\n  kColors.Black,\n  kColors.White,\n] as const;\nconst kTestColorsAll = [...kTestColorsOpaque, kColors.SemitransparentWhite] as const;\n\nfunction makeTestColorsTexelView({\n  testColors,\n  format,\n  width,\n  height,\n  premultiplied,\n  flipY,\n}: {\n  testColors: readonly TestColor[];\n  format: EncodableTextureFormat;\n  width: number;\n  height: number;\n  premultiplied: boolean;\n  flipY: boolean;\n}) {\n  return TexelView.fromTexelsAsColors(format, coords => {\n    const y = flipY ? height - coords.y - 1 : coords.y;\n    const pixelPos = y * width + coords.x;\n    const currentPixel = testColors[pixelPos % testColors.length];\n\n    if (premultiplied && currentPixel.A !== 1.0) {\n      return {\n        R: currentPixel.R! * currentPixel.A!,\n        G: currentPixel.G! * currentPixel.A!,\n        B: currentPixel.B! * currentPixel.A!,\n        A: currentPixel.A,\n      };\n    } else {\n      return currentPixel;\n    }\n  });\n}\n\nexport const g = makeTestGroup(CopyToTextureUtils);\n\ng.test('from_ImageData')\n  .desc(\n    `\n  Test ImageBitmap generated from ImageData can be copied to WebGPU\n  texture correctly. These imageBitmaps are highly possible living\n  in CPU back resource.\n\n  It generates pixels in ImageData one by one based on a color list:\n  [Red, Green, Blue, Black, White, SemitransparentWhite].\n\n  Then call copyExternalImageToTexture() to do a full copy to the 0 mipLevel\n  of dst texture, and read the contents out to compare with the ImageBitmap contents.\n\n  Do premultiply alpha during copy if 'premultipliedAlpha' in 'GPUImageCopyTextureTagged'\n  is set to 'true' and do unpremultiply alpha if it is set to 'false'.\n\n  If 'flipY' in 'GPUImageCopyExternalImage' is set to 'true', copy will ensure the result\n  is flipped.\n\n  The tests covers:\n  - Valid canvas type\n  - Source WebGPU Canvas lives in the same GPUDevice or different GPUDevice as test\n  - Valid dstColorFormat of copyExternalImageToTexture()\n  - Valid source image alphaMode\n  - Valid dest alphaMode\n  - Valid 'flipY' config in 'GPUImageCopyExternalImage' (named 'srcDoFlipYDuringCopy' in cases)\n  - TODO(#913): color space tests need to be added\n\n  And the expected results are all passed.\n  `\n  )\n  .params(u =>\n    u\n      .combine('alpha', ['none', 'premultiply'] as const)\n      .combine('orientation', ['none', 'flipY'] as const)\n      .combine('srcDoFlipYDuringCopy', [true, false])\n      .combine('dstColorFormat', kValidTextureFormatsForCopyE2T)\n      .combine('dstPremultiplied', [true, false])\n      .beginSubcases()\n      .combine('width', [1, 2, 4, 15, 255, 256])\n      .combine('height', [1, 2, 4, 15, 255, 256])\n  )\n  .fn(async t => {\n    const {\n      width,\n      height,\n      alpha,\n      orientation,\n      dstColorFormat,\n      dstPremultiplied,\n      srcDoFlipYDuringCopy,\n    } = t.params;\n\n    const testColors = kTestColorsAll;\n\n    // Generate correct expected values\n    const texelViewSource = makeTestColorsTexelView({\n      testColors,\n      format: 'rgba8unorm', // ImageData is always in rgba8unorm format.\n      width,\n      height,\n      flipY: false,\n      premultiplied: false,\n    });\n    const imageData = new ImageData(width, height);\n    texelViewSource.writeTextureData(imageData.data, {\n      bytesPerRow: width * 4,\n      rowsPerImage: height,\n      subrectOrigin: [0, 0],\n      subrectSize: { width, height },\n    });\n\n    const imageBitmap = await createImageBitmap(imageData, {\n      premultiplyAlpha: alpha,\n      imageOrientation: orientation,\n    });\n\n    const dst = t.device.createTexture({\n      size: { width, height },\n      format: dstColorFormat,\n      usage:\n        GPUTextureUsage.COPY_DST | GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n\n    const expFormat = kTextureFormatInfo[dstColorFormat].baseFormat ?? dstColorFormat;\n    const expectFlipped = srcDoFlipYDuringCopy !== (orientation === 'flipY');\n    const texelViewExpected = makeTestColorsTexelView({\n      testColors,\n      format: expFormat,\n      width,\n      height,\n      flipY: expectFlipped,\n      premultiplied: dstPremultiplied,\n    });\n\n    t.doTestAndCheckResult(\n      { source: imageBitmap, origin: { x: 0, y: 0 }, flipY: srcDoFlipYDuringCopy },\n      {\n        texture: dst,\n        origin: { x: 0, y: 0 },\n        colorSpace: 'srgb',\n        premultipliedAlpha: dstPremultiplied,\n      },\n      texelViewExpected,\n      { width, height, depthOrArrayLayers: 1 },\n      // 1.0 and 0.6 are representable precisely by all formats except rgb10a2unorm, but\n      // allow diffs of 1ULP since that's the generally-appropriate threshold.\n      { maxDiffULPsForFloatFormat: 1, maxDiffULPsForNormFormat: 1 }\n    );\n  });\n\ng.test('from_canvas')\n  .desc(\n    `\n  Test ImageBitmap generated from canvas/offscreenCanvas can be copied to WebGPU\n  texture correctly. These imageBitmaps are highly possible living in GPU back resource.\n\n  It generates pixels in ImageData one by one based on a color list:\n  [Red, Green, Blue, Black, White].\n\n  Then call copyExternalImageToTexture() to do a full copy to the 0 mipLevel\n  of dst texture, and read the contents out to compare with the ImageBitmap contents.\n\n  Do premultiply alpha during copy if 'premultipliedAlpha' in 'GPUImageCopyTextureTagged'\n  is set to 'true' and do unpremultiply alpha if it is set to 'false'.\n\n  If 'flipY' in 'GPUImageCopyExternalImage' is set to 'true', copy will ensure the result\n  is flipped.\n\n  The tests covers:\n  - Valid canvas type\n  - Source WebGPU Canvas lives in the same GPUDevice or different GPUDevice as test\n  - Valid dstColorFormat of copyExternalImageToTexture()\n  - Valid source image alphaMode\n  - Valid dest alphaMode\n  - Valid 'flipY' config in 'GPUImageCopyExternalImage' (named 'srcDoFlipYDuringCopy' in cases)\n  - TODO(#913): color space tests need to be added\n\n  And the expected results are all passed.\n  `\n  )\n  .params(u =>\n    u\n      .combine('orientation', ['none', 'flipY'] as const)\n      .combine('srcDoFlipYDuringCopy', [true, false])\n      .combine('dstColorFormat', kValidTextureFormatsForCopyE2T)\n      .combine('dstPremultiplied', [true, false])\n      .beginSubcases()\n      .combine('width', [1, 2, 4, 15, 255, 256])\n      .combine('height', [1, 2, 4, 15, 255, 256])\n  )\n  .fn(async t => {\n    const {\n      width,\n      height,\n      orientation,\n      dstColorFormat,\n      dstPremultiplied,\n      srcDoFlipYDuringCopy,\n    } = t.params;\n\n    // CTS sometimes runs on worker threads, where document is not available.\n    // In this case, OffscreenCanvas can be used instead of <canvas>.\n    // But some browsers don't support OffscreenCanvas, and some don't\n    // support '2d' contexts on OffscreenCanvas.\n    // In this situation, the case will be skipped.\n    let imageCanvas;\n    if (typeof document !== 'undefined') {\n      imageCanvas = document.createElement('canvas');\n      imageCanvas.width = width;\n      imageCanvas.height = height;\n    } else if (typeof OffscreenCanvas === 'undefined') {\n      t.skip('OffscreenCanvas is not supported');\n      return;\n    } else {\n      imageCanvas = new OffscreenCanvas(width, height);\n    }\n    const imageCanvasContext = imageCanvas.getContext('2d');\n    if (imageCanvasContext === null) {\n      t.skip('OffscreenCanvas \"2d\" context not available');\n      return;\n    }\n\n    // Generate non-transparent pixel data to avoid canvas\n    // different opt behaviour on putImageData()\n    // from browsers.\n    const texelViewSource = makeTestColorsTexelView({\n      testColors: kTestColorsOpaque,\n      format: 'rgba8unorm', // ImageData is always in rgba8unorm format.\n      width,\n      height,\n      flipY: false,\n      premultiplied: false,\n    });\n    // Generate correct expected values\n    const imageData = new ImageData(width, height);\n    texelViewSource.writeTextureData(imageData.data, {\n      bytesPerRow: width * 4,\n      rowsPerImage: height,\n      subrectOrigin: [0, 0],\n      subrectSize: { width, height },\n    });\n\n    // Use putImageData to prevent color space conversion.\n    imageCanvasContext.putImageData(imageData, 0, 0);\n\n    // MAINTENANCE_TODO: Workaround for @types/offscreencanvas missing an overload of\n    // `createImageBitmap` that takes `ImageBitmapOptions`.\n    const imageBitmap = await createImageBitmap(imageCanvas as HTMLCanvasElement, {\n      premultiplyAlpha: 'premultiply',\n      imageOrientation: orientation,\n    });\n\n    const dst = t.device.createTexture({\n      size: { width, height },\n      format: dstColorFormat,\n      usage:\n        GPUTextureUsage.COPY_DST | GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n\n    const expFormat = kTextureFormatInfo[dstColorFormat].baseFormat ?? dstColorFormat;\n    const expectFlipped = srcDoFlipYDuringCopy !== (orientation === 'flipY');\n    const texelViewExpected = makeTestColorsTexelView({\n      testColors: kTestColorsOpaque,\n      format: expFormat,\n      width,\n      height,\n      flipY: expectFlipped,\n      premultiplied: dstPremultiplied,\n    });\n\n    t.doTestAndCheckResult(\n      { source: imageBitmap, origin: { x: 0, y: 0 }, flipY: srcDoFlipYDuringCopy },\n      {\n        texture: dst,\n        origin: { x: 0, y: 0 },\n        colorSpace: 'srgb',\n        premultipliedAlpha: dstPremultiplied,\n      },\n      texelViewExpected,\n      { width, height, depthOrArrayLayers: 1 },\n      // 1.0 and 0.6 are representable precisely by all formats except rgb10a2unorm, but\n      // allow diffs of 1ULP since that's the generally-appropriate threshold.\n      { maxDiffULPsForFloatFormat: 1, maxDiffULPsForNormFormat: 1 }\n    );\n  });\n"],"mappings":"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"}