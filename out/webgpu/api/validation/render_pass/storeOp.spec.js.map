{"version":3,"file":"storeOp.spec.js","names":["description","makeTestGroup","ValidationTest","g","test","paramsSimple","readonly","_valid","depthStoreOp","stencilStoreOp","depthReadOnly","stencilReadOnly","undefined","fn","t","params","depthAttachment","device","createTexture","format","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","RENDER_ATTACHMENT","depthAttachmentView","createView","encoder","createCommandEncoder","pass","beginRenderPass","colorAttachments","depthStencilAttachment","view","depthLoadOp","stencilLoadOp","end","expectValidationError","finish"],"sources":["../../../../../src/webgpu/api/validation/render_pass/storeOp.spec.ts"],"sourcesContent":["export const description = `\nAPI Validation Tests for RenderPass StoreOp.\n\nTest Coverage:\n  - Tests that when depthReadOnly is true, depthStoreOp must be 'store'.\n    - When depthReadOnly is true and depthStoreOp is 'discard', an error should be generated.\n\n  - Tests that when stencilReadOnly is true, stencilStoreOp must be 'store'.\n    - When stencilReadOnly is true and stencilStoreOp is 'discard', an error should be generated.\n\n  - Tests that the depthReadOnly value matches the stencilReadOnly value.\n    - When depthReadOnly does not match stencilReadOnly, an error should be generated.\n\n  - Tests that depthReadOnly and stencilReadOnly default to false.\n\nTODO: test interactions with depthClearValue too\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('store_op_and_read_only')\n  .paramsSimple([\n    { readonly: true, _valid: true },\n    // Using depthReadOnly=true and depthStoreOp='discard' should cause a validation error.\n    { readonly: true, depthStoreOp: 'discard', _valid: false },\n    // Using stencilReadOnly=true and stencilStoreOp='discard' should cause a validation error.\n    { readonly: true, stencilStoreOp: 'discard', _valid: false },\n    // Mismatched depthReadOnly and stencilReadOnly values should cause a validation error.\n    { readonly: false, _valid: true },\n    { readonly: false, depthReadOnly: true, _valid: false },\n    { readonly: false, stencilReadOnly: true, _valid: false },\n    // depthReadOnly and stencilReadOnly should default to false.\n    { readonly: undefined, _valid: true },\n    { readonly: undefined, depthReadOnly: true, _valid: false },\n    { readonly: undefined, stencilReadOnly: true, _valid: false },\n  ] as const)\n  .fn(t => {\n    const {\n      readonly,\n      depthStoreOp = 'store',\n      depthReadOnly = readonly,\n      stencilStoreOp = 'store',\n      stencilReadOnly = readonly,\n      _valid,\n    } = t.params;\n\n    const depthAttachment = t.device.createTexture({\n      format: 'depth24plus-stencil8',\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    const depthAttachmentView = depthAttachment.createView();\n\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [],\n      depthStencilAttachment: {\n        view: depthAttachmentView,\n        depthLoadOp: 'load',\n        depthStoreOp,\n        depthReadOnly,\n        stencilLoadOp: 'load',\n        stencilStoreOp,\n        stencilReadOnly,\n      },\n    });\n    pass.end();\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, !_valid);\n  });\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,cAAc,QAAQ,uBAAuB;;AAEtD,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,cAAc,CAAC;;AAE9CC,CAAC,CAACC,IAAI,CAAC,wBAAwB,CAAC;AAC7BC,YAAY,CAAC;AACZ,EAAEC,QAAQ,EAAE,IAAI,EAAEC,MAAM,EAAE,IAAI,CAAC,CAAC;AAChC;AACA,EAAED,QAAQ,EAAE,IAAI,EAAEE,YAAY,EAAE,SAAS,EAAED,MAAM,EAAE,KAAK,CAAC,CAAC;AAC1D;AACA,EAAED,QAAQ,EAAE,IAAI,EAAEG,cAAc,EAAE,SAAS,EAAEF,MAAM,EAAE,KAAK,CAAC,CAAC;AAC5D;AACA,EAAED,QAAQ,EAAE,KAAK,EAAEC,MAAM,EAAE,IAAI,CAAC,CAAC;AACjC,EAAED,QAAQ,EAAE,KAAK,EAAEI,aAAa,EAAE,IAAI,EAAEH,MAAM,EAAE,KAAK,CAAC,CAAC;AACvD,EAAED,QAAQ,EAAE,KAAK,EAAEK,eAAe,EAAE,IAAI,EAAEJ,MAAM,EAAE,KAAK,CAAC,CAAC;AACzD;AACA,EAAED,QAAQ,EAAEM,SAAS,EAAEL,MAAM,EAAE,IAAI,CAAC,CAAC;AACrC,EAAED,QAAQ,EAAEM,SAAS,EAAEF,aAAa,EAAE,IAAI,EAAEH,MAAM,EAAE,KAAK,CAAC,CAAC;AAC3D,EAAED,QAAQ,EAAEM,SAAS,EAAED,eAAe,EAAE,IAAI,EAAEJ,MAAM,EAAE,KAAK,CAAC,CAAC,CAC9D,CAAU;;AACVM,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM;IACJR,QAAQ;IACRE,YAAY,GAAG,OAAO;IACtBE,aAAa,GAAGJ,QAAQ;IACxBG,cAAc,GAAG,OAAO;IACxBE,eAAe,GAAGL,QAAQ;IAC1BC;EACF,CAAC,GAAGO,CAAC,CAACC,MAAM;;EAEZ,MAAMC,eAAe,GAAGF,CAAC,CAACG,MAAM,CAACC,aAAa,CAAC;IAC7CC,MAAM,EAAE,sBAAsB;IAC9BC,IAAI,EAAE,EAAEC,KAAK,EAAE,CAAC,EAAEC,MAAM,EAAE,CAAC,EAAEC,kBAAkB,EAAE,CAAC,CAAC,CAAC;IACpDC,KAAK,EAAEC,eAAe,CAACC;EACzB,CAAC,CAAC;EACF,MAAMC,mBAAmB,GAAGX,eAAe,CAACY,UAAU,EAAE;;EAExD,MAAMC,OAAO,GAAGf,CAAC,CAACG,MAAM,CAACa,oBAAoB,EAAE;EAC/C,MAAMC,IAAI,GAAGF,OAAO,CAACG,eAAe,CAAC;IACnCC,gBAAgB,EAAE,EAAE;IACpBC,sBAAsB,EAAE;MACtBC,IAAI,EAAER,mBAAmB;MACzBS,WAAW,EAAE,MAAM;MACnB5B,YAAY;MACZE,aAAa;MACb2B,aAAa,EAAE,MAAM;MACrB5B,cAAc;MACdE;IACF;EACF,CAAC,CAAC;EACFoB,IAAI,CAACO,GAAG,EAAE;;EAEVxB,CAAC,CAACyB,qBAAqB,CAAC,MAAM;IAC5BV,OAAO,CAACW,MAAM,EAAE;EAClB,CAAC,EAAE,CAACjC,MAAM,CAAC;AACb,CAAC,CAAC"}