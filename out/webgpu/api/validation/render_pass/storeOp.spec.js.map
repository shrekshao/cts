{"version":3,"sources":["../../../../../src/webgpu/api/validation/render_pass/storeOp.spec.ts"],"names":["description","makeTestGroup","ValidationTest","g","test","paramsSimple","readonly","_valid","depthStoreOp","stencilStoreOp","depthReadOnly","stencilReadOnly","undefined","fn","t","params","depthAttachment","device","createTexture","format","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","RENDER_ATTACHMENT","depthAttachmentView","createView","encoder","createCommandEncoder","pass","beginRenderPass","colorAttachments","depthStencilAttachment","view","depthLoadOp","stencilLoadOp","end","expectValidationError","finish"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAhBO,CAkBP,SAASC,aAAT,QAA8B,4CAA9B;AACA,SAASC,cAAT,QAA+B,uBAA/B;;AAEA,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,cAAD,CAAvB;;AAEPC,CAAC,CAACC,IAAF,CAAO,wBAAP;AACGC,YADH,CACgB;AACZ,EAAEC,QAAQ,EAAE,IAAZ,EAAkBC,MAAM,EAAE,IAA1B,EADY;AAEZ;AACA,EAAED,QAAQ,EAAE,IAAZ,EAAkBE,YAAY,EAAE,SAAhC,EAA2CD,MAAM,EAAE,KAAnD,EAHY;AAIZ;AACA,EAAED,QAAQ,EAAE,IAAZ,EAAkBG,cAAc,EAAE,SAAlC,EAA6CF,MAAM,EAAE,KAArD,EALY;AAMZ;AACA,EAAED,QAAQ,EAAE,KAAZ,EAAmBC,MAAM,EAAE,IAA3B,EAPY;AAQZ,EAAED,QAAQ,EAAE,KAAZ,EAAmBI,aAAa,EAAE,IAAlC,EAAwCH,MAAM,EAAE,KAAhD,EARY;AASZ,EAAED,QAAQ,EAAE,KAAZ,EAAmBK,eAAe,EAAE,IAApC,EAA0CJ,MAAM,EAAE,KAAlD,EATY;AAUZ;AACA,EAAED,QAAQ,EAAEM,SAAZ,EAAuBL,MAAM,EAAE,IAA/B,EAXY;AAYZ,EAAED,QAAQ,EAAEM,SAAZ,EAAuBF,aAAa,EAAE,IAAtC,EAA4CH,MAAM,EAAE,KAApD,EAZY;AAaZ,EAAED,QAAQ,EAAEM,SAAZ,EAAuBD,eAAe,EAAE,IAAxC,EAA8CJ,MAAM,EAAE,KAAtD,EAbY,CADhB;;AAgBGM,EAhBH,CAgBM,OAAMC,CAAN,KAAW;AACb,QAAM;AACJR,IAAAA,QADI;AAEJE,IAAAA,YAAY,GAAG,OAFX;AAGJE,IAAAA,aAAa,GAAGJ,QAHZ;AAIJG,IAAAA,cAAc,GAAG,OAJb;AAKJE,IAAAA,eAAe,GAAGL,QALd;AAMJC,IAAAA,MANI;AAOFO,EAAAA,CAAC,CAACC,MAPN;;AASA,QAAMC,eAAe,GAAGF,CAAC,CAACG,MAAF,CAASC,aAAT,CAAuB;AAC7CC,IAAAA,MAAM,EAAE,sBADqC;AAE7CC,IAAAA,IAAI,EAAE,EAAEC,KAAK,EAAE,CAAT,EAAYC,MAAM,EAAE,CAApB,EAAuBC,kBAAkB,EAAE,CAA3C,EAFuC;AAG7CC,IAAAA,KAAK,EAAEC,eAAe,CAACC,iBAHsB,EAAvB,CAAxB;;AAKA,QAAMC,mBAAmB,GAAGX,eAAe,CAACY,UAAhB,EAA5B;;AAEA,QAAMC,OAAO,GAAGf,CAAC,CAACG,MAAF,CAASa,oBAAT,EAAhB;AACA,QAAMC,IAAI,GAAGF,OAAO,CAACG,eAAR,CAAwB;AACnCC,IAAAA,gBAAgB,EAAE,EADiB;AAEnCC,IAAAA,sBAAsB,EAAE;AACtBC,MAAAA,IAAI,EAAER,mBADgB;AAEtBS,MAAAA,WAAW,EAAE,MAFS;AAGtB5B,MAAAA,YAHsB;AAItBE,MAAAA,aAJsB;AAKtB2B,MAAAA,aAAa,EAAE,MALO;AAMtB5B,MAAAA,cANsB;AAOtBE,MAAAA,eAPsB,EAFW,EAAxB,CAAb;;;AAYAoB,EAAAA,IAAI,CAACO,GAAL;;AAEAxB,EAAAA,CAAC,CAACyB,qBAAF,CAAwB,MAAM;AAC5BV,IAAAA,OAAO,CAACW,MAAR;AACD,GAFD,EAEG,CAACjC,MAFJ;AAGD,CAnDH","sourcesContent":["export const description = `\nAPI Validation Tests for RenderPass StoreOp.\n\nTest Coverage:\n  - Tests that when depthReadOnly is true, depthStoreOp must be 'store'.\n    - When depthReadOnly is true and depthStoreOp is 'discard', an error should be generated.\n\n  - Tests that when stencilReadOnly is true, stencilStoreOp must be 'store'.\n    - When stencilReadOnly is true and stencilStoreOp is 'discard', an error should be generated.\n\n  - Tests that the depthReadOnly value matches the stencilReadOnly value.\n    - When depthReadOnly does not match stencilReadOnly, an error should be generated.\n\n  - Tests that depthReadOnly and stencilReadOnly default to false.\n\nTODO: test interactions with depthClearValue too\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('store_op_and_read_only')\n  .paramsSimple([\n    { readonly: true, _valid: true },\n    // Using depthReadOnly=true and depthStoreOp='discard' should cause a validation error.\n    { readonly: true, depthStoreOp: 'discard', _valid: false },\n    // Using stencilReadOnly=true and stencilStoreOp='discard' should cause a validation error.\n    { readonly: true, stencilStoreOp: 'discard', _valid: false },\n    // Mismatched depthReadOnly and stencilReadOnly values should cause a validation error.\n    { readonly: false, _valid: true },\n    { readonly: false, depthReadOnly: true, _valid: false },\n    { readonly: false, stencilReadOnly: true, _valid: false },\n    // depthReadOnly and stencilReadOnly should default to false.\n    { readonly: undefined, _valid: true },\n    { readonly: undefined, depthReadOnly: true, _valid: false },\n    { readonly: undefined, stencilReadOnly: true, _valid: false },\n  ] as const)\n  .fn(async t => {\n    const {\n      readonly,\n      depthStoreOp = 'store',\n      depthReadOnly = readonly,\n      stencilStoreOp = 'store',\n      stencilReadOnly = readonly,\n      _valid,\n    } = t.params;\n\n    const depthAttachment = t.device.createTexture({\n      format: 'depth24plus-stencil8',\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n    const depthAttachmentView = depthAttachment.createView();\n\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [],\n      depthStencilAttachment: {\n        view: depthAttachmentView,\n        depthLoadOp: 'load',\n        depthStoreOp,\n        depthReadOnly,\n        stencilLoadOp: 'load',\n        stencilStoreOp,\n        stencilReadOnly,\n      },\n    });\n    pass.end();\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, !_valid);\n  });\n"],"file":"storeOp.spec.js"}