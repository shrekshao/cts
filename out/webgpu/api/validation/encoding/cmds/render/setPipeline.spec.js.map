{"version":3,"sources":["../../../../../../../src/webgpu/api/validation/encoding/cmds/render/setPipeline.spec.ts"],"names":["description","makeTestGroup","kRenderEncodeTypes","ValidationTest","kRenderEncodeTypeParams","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","encoderType","state","params","pipeline","createRenderPipelineWithState","encoder","validateFinish","createEncoder","setPipeline","mismatched","selectMismatchedDeviceOrSkipTestCase","undefined","device","mismatchedDevice","createRenderPipeline","vertex","module","createShaderModule","code","entryPoint","fragment","targets","format","writeMask","primitive","topology"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAFO,CAIP,SAASC,aAAT,QAA8B,kDAA9B;AACA,SAASC,kBAAT,QAAmC,6CAAnC;AACA,SAASC,cAAT,QAA+B,6BAA/B;;AAEA,SAASC,uBAAT,QAAwC,aAAxC;;AAEA,OAAO,MAAMC,CAAC,GAAGJ,aAAa,CAACE,cAAD,CAAvB;;AAEPE,CAAC,CAACC,IAAF,CAAO,kBAAP;AACGC,IADH;AAEK;AACL;AACA,GAJA;;AAMGC,kBANH,CAMsB,CAAAC,CAAC;AACnBA,CAAC,CAACC,OAAF,CAAU,aAAV,EAAyBR,kBAAzB,EAA6CQ,OAA7C,CAAqD,OAArD,EAA8D,CAAC,OAAD,EAAU,SAAV,CAA9D,CAPJ;;AASGC,EATH,CASM,CAAAC,CAAC,KAAI;AACP,QAAM,EAAEC,WAAF,EAAeC,KAAf,KAAyBF,CAAC,CAACG,MAAjC;AACA,QAAMC,QAAQ,GAAGJ,CAAC,CAACK,6BAAF,CAAgCH,KAAhC,CAAjB;;AAEA,QAAM,EAAEI,OAAF,EAAWC,cAAX,KAA8BP,CAAC,CAACQ,aAAF,CAAgBP,WAAhB,CAApC;AACAK,EAAAA,OAAO,CAACG,WAAR,CAAoBL,QAApB;AACAG,EAAAA,cAAc,CAACL,KAAK,KAAK,SAAX,CAAd;AACD,CAhBH;;AAkBAT,CAAC,CAACC,IAAF,CAAO,0BAAP;AACGC,IADH,CACQ,uFADR;AAEGC,kBAFH,CAEsBJ,uBAAuB,CAACM,OAAxB,CAAgC,YAAhC,EAA8C,CAAC,IAAD,EAAO,KAAP,CAA9C,CAFtB;AAGGC,EAHH,CAGM,OAAMC,CAAN,KAAW;AACb,QAAM,EAAEC,WAAF,EAAeS,UAAf,KAA8BV,CAAC,CAACG,MAAtC;;AAEA,MAAIO,UAAJ,EAAgB;AACd,UAAMV,CAAC,CAACW,oCAAF,CAAuCC,SAAvC,CAAN;AACD;;AAED,QAAMC,MAAM,GAAGH,UAAU,GAAGV,CAAC,CAACc,gBAAL,GAAwBd,CAAC,CAACa,MAAnD;;AAEA,QAAMT,QAAQ,GAAGS,MAAM,CAACE,oBAAP,CAA4B;AAC3CC,IAAAA,MAAM,EAAE;AACNC,MAAAA,MAAM,EAAEJ,MAAM,CAACK,kBAAP,CAA0B;AAChCC,QAAAA,IAAI,EAAG,kFADyB,EAA1B,CADF;;AAINC,MAAAA,UAAU,EAAE,MAJN,EADmC;;AAO3CC,IAAAA,QAAQ,EAAE;AACRJ,MAAAA,MAAM,EAAEJ,MAAM,CAACK,kBAAP,CAA0B;AAChCC,QAAAA,IAAI,EAAE,+BAD0B,EAA1B,CADA;;AAIRC,MAAAA,UAAU,EAAE,MAJJ;AAKRE,MAAAA,OAAO,EAAE,CAAC,EAAEC,MAAM,EAAE,YAAV,EAAwBC,SAAS,EAAE,CAAnC,EAAD,CALD,EAPiC;;AAc3CC,IAAAA,SAAS,EAAE,EAAEC,QAAQ,EAAE,eAAZ,EAdgC,EAA5B,CAAjB;;;AAiBA,QAAM,EAAEpB,OAAF,EAAWC,cAAX,KAA8BP,CAAC,CAACQ,aAAF,CAAgBP,WAAhB,CAApC;AACAK,EAAAA,OAAO,CAACG,WAAR,CAAoBL,QAApB;AACAG,EAAAA,cAAc,CAAC,CAACG,UAAF,CAAd;AACD,CAhCH","sourcesContent":["export const description = `\nValidation tests for setPipeline on render pass and render bundle.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { kRenderEncodeTypes } from '../../../../../util/command_buffer_maker.js';\nimport { ValidationTest } from '../../../validation_test.js';\n\nimport { kRenderEncodeTypeParams } from './render.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('invalid_pipeline')\n  .desc(\n    `\nTests setPipeline should generate an error iff using an 'invalid' pipeline.\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u.combine('encoderType', kRenderEncodeTypes).combine('state', ['valid', 'invalid'] as const)\n  )\n  .fn(t => {\n    const { encoderType, state } = t.params;\n    const pipeline = t.createRenderPipelineWithState(state);\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setPipeline(pipeline);\n    validateFinish(state !== 'invalid');\n  });\n\ng.test('pipeline,device_mismatch')\n  .desc('Tests setPipeline cannot be called with a render pipeline created from another device')\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('mismatched', [true, false]))\n  .fn(async t => {\n    const { encoderType, mismatched } = t.params;\n\n    if (mismatched) {\n      await t.selectMismatchedDeviceOrSkipTestCase(undefined);\n    }\n\n    const device = mismatched ? t.mismatchedDevice : t.device;\n\n    const pipeline = device.createRenderPipeline({\n      vertex: {\n        module: device.createShaderModule({\n          code: `@stage(vertex) fn main() -> @builtin(position) vec4<f32> { return vec4<f32>(); }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: device.createShaderModule({\n          code: '@stage(fragment) fn main() {}',\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm', writeMask: 0 }],\n      },\n      primitive: { topology: 'triangle-list' },\n    });\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setPipeline(pipeline);\n    validateFinish(!mismatched);\n  });\n"],"file":"setPipeline.spec.js"}