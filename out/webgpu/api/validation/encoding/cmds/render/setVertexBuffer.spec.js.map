{"version":3,"sources":["../../../../../../../src/webgpu/api/validation/encoding/cmds/render/setVertexBuffer.spec.ts"],"names":["description","makeTestGroup","kLimitInfo","GPUConst","kResourceStates","ValidationTest","kRenderEncodeTypeParams","buildBufferOffsetAndSizeOOBTestParams","g","test","desc","paramsSubcasesOnly","combine","maxVertexBuffers","default","fn","t","encoderType","slot","params","vertexBuffer","createBufferWithState","size","usage","GPUBufferUsage","VERTEX","encoder","validateFinish","createEncoder","setVertexBuffer","state","validateFinishAndSubmitGivenState","beforeAllSubcases","selectMismatchedDeviceOrSkipTestCase","undefined","mismatched","device","mismatchedDevice","createBuffer","trackForCleanup","BufferUsage","COPY_DST","offset","finish","_valid"],"mappings":"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","sourcesContent":["export const description = `\nValidation tests for setVertexBuffer on render pass and render bundle.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { kLimitInfo } from '../../../../../capability_info.js';\nimport { GPUConst } from '../../../../../constants.js';\nimport { kResourceStates } from '../../../../../gpu_test.js';\nimport { ValidationTest } from '../../../validation_test.js';\n\nimport { kRenderEncodeTypeParams, buildBufferOffsetAndSizeOOBTestParams } from './render.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('slot')\n  .desc(\n    `\nTests slot must be less than the maxVertexBuffers in device limits.\n  `\n  )\n  .paramsSubcasesOnly(\n    kRenderEncodeTypeParams.combine('slot', [\n      0,\n      kLimitInfo.maxVertexBuffers.default - 1,\n      kLimitInfo.maxVertexBuffers.default,\n    ] as const)\n  )\n  .fn(t => {\n    const { encoderType, slot } = t.params;\n    const vertexBuffer = t.createBufferWithState('valid', {\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(slot, vertexBuffer);\n    validateFinish(slot < kLimitInfo.maxVertexBuffers.default);\n  });\n\ng.test('vertex_buffer_state')\n  .desc(\n    `\nTests vertex buffer must be valid.\n  `\n  )\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('state', kResourceStates))\n  .fn(t => {\n    const { encoderType, state } = t.params;\n    const vertexBuffer = t.createBufferWithState(state, {\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, validateFinishAndSubmitGivenState } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer);\n    validateFinishAndSubmitGivenState(state);\n  });\n\ng.test('vertex_buffer,device_mismatch')\n  .desc('Tests setVertexBuffer cannot be called with a vertex buffer created from another device')\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('mismatched', [true, false]))\n  .beforeAllSubcases(t => {\n    t.selectMismatchedDeviceOrSkipTestCase(undefined);\n  })\n  .fn(async t => {\n    const { encoderType, mismatched } = t.params;\n    const device = mismatched ? t.mismatchedDevice : t.device;\n\n    const vertexBuffer = device.createBuffer({\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n    t.trackForCleanup(vertexBuffer);\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer);\n    validateFinish(!mismatched);\n  });\n\ng.test('vertex_buffer_usage')\n  .desc(\n    `\nTests vertex buffer must have 'Vertex' usage.\n  `\n  )\n  .paramsSubcasesOnly(\n    kRenderEncodeTypeParams.combine('usage', [\n      GPUConst.BufferUsage.VERTEX, // control case\n      GPUConst.BufferUsage.COPY_DST,\n      GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.VERTEX,\n    ] as const)\n  )\n  .fn(t => {\n    const { encoderType, usage } = t.params;\n    const vertexBuffer = t.device.createBuffer({\n      size: 16,\n      usage,\n    });\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer);\n    validateFinish((usage & GPUBufferUsage.VERTEX) !== 0);\n  });\n\ng.test('offset_alignment')\n  .desc(\n    `\nTests offset must be a multiple of 4.\n  `\n  )\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('offset', [0, 2, 4] as const))\n  .fn(t => {\n    const { encoderType, offset } = t.params;\n    const vertexBuffer = t.device.createBuffer({\n      size: 16,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, validateFinish: finish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer, offset);\n    finish(offset % 4 === 0);\n  });\n\ng.test('offset_and_size_oob')\n  .desc(\n    `\nTests offset and size cannot be larger than vertex buffer size.\n  `\n  )\n  .paramsSubcasesOnly(buildBufferOffsetAndSizeOOBTestParams(4, 256))\n  .fn(t => {\n    const { encoderType, offset, size, _valid } = t.params;\n    const vertexBuffer = t.device.createBuffer({\n      size: 256,\n      usage: GPUBufferUsage.VERTEX,\n    });\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setVertexBuffer(0, vertexBuffer, offset, size);\n    validateFinish(_valid);\n  });\n"],"file":"setVertexBuffer.spec.js"}