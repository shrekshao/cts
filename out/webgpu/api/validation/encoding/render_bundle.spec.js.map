{"version":3,"sources":["../../../../../src/webgpu/api/validation/encoding/render_bundle.spec.ts"],"names":["description","makeTestGroup","kDepthStencilFormats","kTextureFormatInfo","ValidationTest","g","test","desc","fn","t","encoder","createEncoder","executeBundles","validateFinish","paramsSubcasesOnly","bundle0Mismatched","bundle1Mismatched","params","mismatched","selectMismatchedDeviceOrSkipTestCase","undefined","descriptor","colorFormats","bundle0Encoder","mismatchedDevice","createRenderBundleEncoder","device","bundle0","finish","bundle1Encoder","bundle1","u","combineWithParams","bundleFormats","passFormats","_compatible","bundleEncoder","bundle","attachmentInfo","bundleFormat","passFormat","selectDeviceForTextureFormatOrSkipTestCase","compatible","depthStencilFormat","combine","bundleDepthReadOnly","bundleStencilReadOnly","passDepthReadOnly","passStencilReadOnly","depthStencilInfo","depth","stencil","depthReadOnly","stencilReadOnly","bundleSamples","passSamples","sampleCount"],"mappings":"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","sourcesContent":["export const description = `\nTests execution of render bundles.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kDepthStencilFormats, kTextureFormatInfo } from '../../../capability_info.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('empty_bundle_list')\n  .desc(\n    `\n    Test that it is valid to execute an empty list of render bundles\n    `\n  )\n  .fn(async t => {\n    const encoder = t.createEncoder('render pass');\n    encoder.encoder.executeBundles([]);\n    encoder.validateFinish(true);\n  });\n\ng.test('device_mismatch')\n  .desc(\n    `\n    Tests executeBundles cannot be called with render bundles created from another device\n    Test with two bundles to make sure all bundles can be validated:\n    - bundle0 and bundle1 from same device\n    - bundle0 and bundle1 from different device\n    `\n  )\n  .paramsSubcasesOnly([\n    { bundle0Mismatched: false, bundle1Mismatched: false }, // control case\n    { bundle0Mismatched: true, bundle1Mismatched: false },\n    { bundle0Mismatched: false, bundle1Mismatched: true },\n  ])\n  .fn(async t => {\n    const { bundle0Mismatched, bundle1Mismatched } = t.params;\n    const mismatched = bundle0Mismatched || bundle1Mismatched;\n\n    if (mismatched) {\n      await t.selectMismatchedDeviceOrSkipTestCase(undefined);\n    }\n\n    const descriptor: GPURenderBundleEncoderDescriptor = {\n      colorFormats: ['rgba8unorm'],\n    };\n\n    const bundle0Encoder = mismatched\n      ? t.mismatchedDevice.createRenderBundleEncoder(descriptor)\n      : t.device.createRenderBundleEncoder(descriptor);\n    const bundle0 = bundle0Encoder.finish();\n    const bundle1Encoder = mismatched\n      ? t.mismatchedDevice.createRenderBundleEncoder(descriptor)\n      : t.device.createRenderBundleEncoder(descriptor);\n    const bundle1 = bundle1Encoder.finish();\n\n    const encoder = t.createEncoder('render pass');\n    encoder.encoder.executeBundles([bundle0, bundle1]);\n\n    encoder.validateFinish(!mismatched);\n  });\n\ng.test('color_formats_mismatch')\n  .desc(\n    `\n    Tests executeBundles cannot be called with render bundles that do match the colorFormats of the\n    render pass. This includes:\n    - formats don't match\n    - formats match but are in a different order\n    - formats match but there is a different count\n    `\n  )\n  .params(u =>\n    u.combineWithParams([\n      {\n        bundleFormats: ['bgra8unorm', 'rg8unorm'] as const,\n        passFormats: ['bgra8unorm', 'rg8unorm'] as const,\n        _compatible: true,\n      }, // control case\n      {\n        bundleFormats: ['bgra8unorm', 'rg8unorm'] as const,\n        passFormats: ['bgra8unorm', 'bgra8unorm'] as const,\n        _compatible: false,\n      },\n      {\n        bundleFormats: ['bgra8unorm', 'rg8unorm'] as const,\n        passFormats: ['rg8unorm', 'bgra8unorm'] as const,\n        _compatible: false,\n      },\n      {\n        bundleFormats: ['bgra8unorm', 'rg8unorm', 'rgba8unorm'] as const,\n        passFormats: ['rg8unorm', 'bgra8unorm'] as const,\n        _compatible: false,\n      },\n      {\n        bundleFormats: ['bgra8unorm', 'rg8unorm'] as const,\n        passFormats: ['rg8unorm', 'bgra8unorm', 'rgba8unorm'] as const,\n        _compatible: false,\n      },\n    ])\n  )\n  .fn(async t => {\n    const { bundleFormats, passFormats, _compatible } = t.params;\n\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: bundleFormats,\n    });\n    const bundle = bundleEncoder.finish();\n\n    const encoder = t.createEncoder('render pass', {\n      attachmentInfo: {\n        colorFormats: passFormats,\n      },\n    });\n    encoder.encoder.executeBundles([bundle]);\n\n    encoder.validateFinish(_compatible);\n  });\n\ng.test('depth_stencil_formats_mismatch')\n  .desc(\n    `\n    Tests executeBundles cannot be called with render bundles that do match the depthStencil of the\n    render pass. This includes:\n    - formats don't match\n    - formats have matching depth or stencil aspects, but other aspects are missing\n    `\n  )\n  .params(u =>\n    u.combineWithParams([\n      { bundleFormat: 'depth24plus', passFormat: 'depth24plus' }, // control case\n      { bundleFormat: 'depth24plus', passFormat: 'depth16unorm' },\n      { bundleFormat: 'depth24plus', passFormat: 'depth24plus-stencil8' },\n      { bundleFormat: 'stencil8', passFormat: 'depth24plus-stencil8' },\n    ] as const)\n  )\n  .fn(async t => {\n    const { bundleFormat, passFormat } = t.params;\n    await t.selectDeviceForTextureFormatOrSkipTestCase([bundleFormat, passFormat]);\n\n    const compatible = bundleFormat === passFormat;\n\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: [],\n      depthStencilFormat: bundleFormat,\n    });\n    const bundle = bundleEncoder.finish();\n\n    const encoder = t.createEncoder('render pass', {\n      attachmentInfo: {\n        colorFormats: [],\n        depthStencilFormat: passFormat,\n      },\n    });\n    encoder.encoder.executeBundles([bundle]);\n\n    encoder.validateFinish(compatible);\n  });\n\ng.test('depth_stencil_readonly_mismatch')\n  .desc(\n    `\n    Tests executeBundles cannot be called with render bundles that do match the depthStencil\n    readonly state of the render pass.\n    `\n  )\n  .params(u =>\n    u.combine('depthStencilFormat', kDepthStencilFormats).combineWithParams([\n      {\n        bundleDepthReadOnly: false,\n        bundleStencilReadOnly: false,\n        passDepthReadOnly: false,\n        passStencilReadOnly: false,\n      },\n      {\n        bundleDepthReadOnly: true,\n        bundleStencilReadOnly: false,\n        passDepthReadOnly: true,\n        passStencilReadOnly: false,\n      },\n      {\n        bundleDepthReadOnly: false,\n        bundleStencilReadOnly: true,\n        passDepthReadOnly: false,\n        passStencilReadOnly: true,\n      },\n      {\n        bundleDepthReadOnly: true,\n        bundleStencilReadOnly: true,\n        passDepthReadOnly: true,\n        passStencilReadOnly: true,\n      },\n      {\n        bundleDepthReadOnly: true,\n        bundleStencilReadOnly: false,\n        passDepthReadOnly: true,\n        passStencilReadOnly: true,\n      },\n      {\n        bundleDepthReadOnly: false,\n        bundleStencilReadOnly: true,\n        passDepthReadOnly: true,\n        passStencilReadOnly: true,\n      },\n      {\n        bundleDepthReadOnly: false,\n        bundleStencilReadOnly: false,\n        passDepthReadOnly: true,\n        passStencilReadOnly: true,\n      },\n      {\n        bundleDepthReadOnly: true,\n        bundleStencilReadOnly: true,\n        passDepthReadOnly: false,\n        passStencilReadOnly: true,\n      },\n      {\n        bundleDepthReadOnly: true,\n        bundleStencilReadOnly: true,\n        passDepthReadOnly: true,\n        passStencilReadOnly: false,\n      },\n      {\n        bundleDepthReadOnly: true,\n        bundleStencilReadOnly: true,\n        passDepthReadOnly: false,\n        passStencilReadOnly: false,\n      },\n    ])\n  )\n  .fn(async t => {\n    const {\n      depthStencilFormat,\n      bundleDepthReadOnly,\n      bundleStencilReadOnly,\n      passDepthReadOnly,\n      passStencilReadOnly,\n    } = t.params;\n    await t.selectDeviceForTextureFormatOrSkipTestCase(depthStencilFormat);\n\n    let compatible =\n      bundleDepthReadOnly === passDepthReadOnly && bundleStencilReadOnly === passStencilReadOnly;\n\n    const depthStencilInfo = kTextureFormatInfo[depthStencilFormat];\n    if (depthStencilInfo.depth && depthStencilInfo.stencil) {\n      compatible = compatible && bundleDepthReadOnly === bundleStencilReadOnly;\n    }\n\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: [],\n      depthStencilFormat,\n      depthReadOnly: bundleDepthReadOnly,\n      stencilReadOnly: bundleStencilReadOnly,\n    });\n    const bundle = bundleEncoder.finish();\n\n    const encoder = t.createEncoder('render pass', {\n      attachmentInfo: {\n        colorFormats: [],\n        depthStencilFormat,\n        depthReadOnly: passDepthReadOnly,\n        stencilReadOnly: passStencilReadOnly,\n      },\n    });\n    encoder.encoder.executeBundles([bundle]);\n\n    encoder.validateFinish(compatible);\n  });\n\ng.test('sample_count_mismatch')\n  .desc(\n    `\n    Tests executeBundles cannot be called with render bundles that do match the sampleCount of the\n    render pass.\n    `\n  )\n  .params(u =>\n    u.combineWithParams([\n      { bundleSamples: 1, passSamples: 1 }, // control case\n      { bundleSamples: 4, passSamples: 4 }, // control case\n      { bundleFormat: 4, passFormat: 1 },\n      { bundleFormat: 1, passFormat: 4 },\n    ])\n  )\n  .fn(async t => {\n    const { bundleSamples, passSamples } = t.params;\n\n    const compatible = bundleSamples === passSamples;\n\n    const bundleEncoder = t.device.createRenderBundleEncoder({\n      colorFormats: ['bgra8unorm'],\n      sampleCount: bundleSamples,\n    });\n    const bundle = bundleEncoder.finish();\n\n    const encoder = t.createEncoder('render pass', {\n      attachmentInfo: {\n        colorFormats: ['bgra8unorm'],\n        sampleCount: passSamples,\n      },\n    });\n    encoder.encoder.executeBundles([bundle]);\n\n    encoder.validateFinish(compatible);\n  });\n"],"file":"render_bundle.spec.js"}