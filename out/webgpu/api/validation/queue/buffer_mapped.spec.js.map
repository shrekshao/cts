{"version":3,"sources":["../../../../../src/webgpu/api/validation/queue/buffer_mapped.spec.ts"],"names":["description","makeTestGroup","ValidationTest","g","test","fn","t","buffer","device","createBuffer","size","usage","GPUBufferUsage","MAP_WRITE","COPY_SRC","targetBuffer","COPY_DST","getCommandBuffer","commandEncoder","createCommandEncoder","copyBufferToBuffer","finish","queue","submit","mapAsync","GPUMapMode","WRITE","expectValidationError","unmap"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CARO,CAUP,SAASC,aAAT,QAA8B,4CAA9B;AACA,SAASC,cAAT,QAA+B,uBAA/B;;AAEA,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,cAAD,CAAvB;;AAEPC,CAAC,CAACC,IAAF,CAAO,QAAP,EAAiBC,EAAjB,CAAoB,MAAMC,CAAN,IAAW;AAC7B,QAAMC,MAAM,GAAGD,CAAC,CAACE,MAAF,CAASC,YAAT,CAAsB;AACnCC,IAAAA,IAAI,EAAE,CAD6B;AAEnCC,IAAAA,KAAK,EAAEC,cAAc,CAACC,SAAf,GAA2BD,cAAc,CAACE,QAFd,EAAtB,CAAf;;;AAKA,QAAMC,YAAY,GAAGT,CAAC,CAACE,MAAF,CAASC,YAAT,CAAsB;AACzCC,IAAAA,IAAI,EAAE,CADmC;AAEzCC,IAAAA,KAAK,EAAEC,cAAc,CAACI,QAFmB,EAAtB,CAArB;;;AAKA,QAAMC,gBAAgB,GAAG,MAAwB;AAC/C,UAAMC,cAAc,GAAGZ,CAAC,CAACE,MAAF,CAASW,oBAAT,EAAvB;AACAD,IAAAA,cAAc,CAACE,kBAAf,CAAkCb,MAAlC,EAA0C,CAA1C,EAA6CQ,YAA7C,EAA2D,CAA3D,EAA8D,CAA9D;AACA,WAAOG,cAAc,CAACG,MAAf,EAAP;AACD,GAJD;;AAMA;AACAf,EAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,CAACN,gBAAgB,EAAjB,CAAf;;AAEA;AACA,QAAMV,MAAM,CAACiB,QAAP,CAAgBC,UAAU,CAACC,KAA3B,CAAN;AACApB,EAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,EAAf;;AAEAjB,EAAAA,CAAC,CAACqB,qBAAF,CAAwB,MAAM;AAC5BrB,IAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,CAACN,gBAAgB,EAAjB,CAAf;AACD,GAFD;;AAIA;AACAV,EAAAA,MAAM,CAACqB,KAAP;AACAtB,EAAAA,CAAC,CAACgB,KAAF,CAAQC,MAAR,CAAe,CAACN,gBAAgB,EAAjB,CAAf;AACD,CA/BD","sourcesContent":["export const description = `\nTests for map-state of mappable buffers used in submitted command buffers.\n\n- x= just before queue op, buffer in {BufferMapStatesToTest}\n- x= in every possible place for mappable buffer:\n  {submit, writeBuffer, copyB2B {src,dst}, copyB2T, copyT2B, ..?}\n\nTODO: generalize existing test\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('submit').fn(async t => {\n  const buffer = t.device.createBuffer({\n    size: 4,\n    usage: GPUBufferUsage.MAP_WRITE | GPUBufferUsage.COPY_SRC,\n  });\n\n  const targetBuffer = t.device.createBuffer({\n    size: 4,\n    usage: GPUBufferUsage.COPY_DST,\n  });\n\n  const getCommandBuffer = (): GPUCommandBuffer => {\n    const commandEncoder = t.device.createCommandEncoder();\n    commandEncoder.copyBufferToBuffer(buffer, 0, targetBuffer, 0, 4);\n    return commandEncoder.finish();\n  };\n\n  // Submitting when the buffer has never been mapped should succeed\n  t.queue.submit([getCommandBuffer()]);\n\n  // Map the buffer, submitting when the buffer is mapped (even with no getMappedRange) should fail\n  await buffer.mapAsync(GPUMapMode.WRITE);\n  t.queue.submit([]);\n\n  t.expectValidationError(() => {\n    t.queue.submit([getCommandBuffer()]);\n  });\n\n  // Unmap the buffer, queue submit should succeed\n  buffer.unmap();\n  t.queue.submit([getCommandBuffer()]);\n});\n"],"file":"buffer_mapped.spec.js"}