{"version":3,"sources":["../../../../../src/webgpu/api/validation/image_copy/texture_related.spec.ts"],"names":["description","makeTestGroup","assert","kColorTextureFormats","kSizedTextureFormats","kTextureDimensions","kTextureFormatInfo","textureDimensionAndFormatCompatible","GPUConst","kResourceStates","align","virtualMipSize","kImageCopyTypes","ImageCopyTest","texelBlockAlignmentTestExpanderForValueToCoordinate","formatCopyableWithMethod","getACopyableAspectWithMethod","g","test","desc","params","u","combine","combineWithParams","dimension","size","fn","t","method","textureState","texture","createTextureWithState","format","usage","GPUTextureUsage","COPY_SRC","COPY_DST","success","submit","testRun","bytesPerRow","width","height","depthOrArrayLayers","dataSize","paramsSubcasesOnly","beforeAllSubcases","selectMismatchedDeviceOrSkipTestCase","undefined","mismatched","device","mismatchedDevice","createTexture","beginSubcases","TextureUsage","TEXTURE_BINDING","sampleCount","unless","p","mipLevelCount","mipLevel","filter","expand","d","info","selectDeviceOrSkipTestCase","feature","copyWidthModifier","copyHeightModifier","copyDepthModifier","blockWidth","blockHeight","depth","stencil","levelSize","copySize","aspect","rowsPerImage","coordinateToTest","valueToCoordinate","origin","x","y","z","createAlignedTexture","Math","max","ceil","bytesPerBlock","originValue","copySizeValue","textureSizeValue","textureSize"],"mappings":"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","sourcesContent":["export const description = `Texture related validation tests for B2T copy and T2B copy and writeTexture.`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert } from '../../../../common/util/util.js';\nimport {\n  kColorTextureFormats,\n  kSizedTextureFormats,\n  kTextureDimensions,\n  kTextureFormatInfo,\n  textureDimensionAndFormatCompatible,\n} from '../../../capability_info.js';\nimport { GPUConst } from '../../../constants.js';\nimport { kResourceStates } from '../../../gpu_test.js';\nimport { align } from '../../../util/math.js';\nimport { virtualMipSize } from '../../../util/texture/base.js';\nimport { kImageCopyTypes } from '../../../util/texture/layout.js';\n\nimport {\n  ImageCopyTest,\n  texelBlockAlignmentTestExpanderForValueToCoordinate,\n  formatCopyableWithMethod,\n  getACopyableAspectWithMethod,\n} from './image_copy.js';\n\nexport const g = makeTestGroup(ImageCopyTest);\n\ng.test('valid')\n  .desc(\n    `\nTest that the texture must be valid and not destroyed.\n- for all copy methods\n- for all texture states\n- for various dimensions\n`\n  )\n  .params(u =>\n    u //\n      .combine('method', kImageCopyTypes)\n      .combine('textureState', kResourceStates)\n      .combineWithParams([\n        { dimension: '1d', size: [4, 1, 1] },\n        { dimension: '2d', size: [4, 4, 1] },\n        { dimension: '2d', size: [4, 4, 3] },\n        { dimension: '3d', size: [4, 4, 3] },\n      ] as const)\n  )\n  .fn(async t => {\n    const { method, textureState, size, dimension } = t.params;\n\n    const texture = t.createTextureWithState(textureState, {\n      size,\n      dimension,\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n    });\n\n    const success = textureState === 'valid';\n    const submit = textureState !== 'invalid';\n\n    t.testRun(\n      { texture },\n      { bytesPerRow: 0 },\n      { width: 0, height: 0, depthOrArrayLayers: 0 },\n      { dataSize: 1, method, success, submit }\n    );\n  });\n\ng.test('texture,device_mismatch')\n  .desc('Tests the image copies cannot be called with a texture created from another device')\n  .paramsSubcasesOnly(u =>\n    u.combine('method', kImageCopyTypes).combine('mismatched', [true, false])\n  )\n  .beforeAllSubcases(async t => {\n    await t.selectMismatchedDeviceOrSkipTestCase(undefined);\n  })\n  .fn(async t => {\n    const { method, mismatched } = t.params;\n    const device = mismatched ? t.mismatchedDevice : t.device;\n\n    const texture = device.createTexture({\n      size: { width: 4, height: 4, depthOrArrayLayers: 1 },\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n    });\n\n    t.testRun(\n      { texture },\n      { bytesPerRow: 0 },\n      { width: 0, height: 0, depthOrArrayLayers: 0 },\n      { dataSize: 1, method, success: !mismatched }\n    );\n  });\n\ng.test('usage')\n  .desc(\n    `\nThe texture must have the appropriate COPY_SRC/COPY_DST usage.\n- for various copy methods\n- for various dimensions\n- for various usages\n\nTODO: update to test all texture usages`\n  )\n  .params(u =>\n    u\n      .combine('method', kImageCopyTypes)\n      .combineWithParams([\n        { dimension: '1d', size: [4, 1, 1] },\n        { dimension: '2d', size: [4, 4, 1] },\n        { dimension: '2d', size: [4, 4, 3] },\n        { dimension: '3d', size: [4, 4, 3] },\n      ] as const)\n      .beginSubcases()\n      .combine('usage', [\n        GPUConst.TextureUsage.COPY_SRC | GPUConst.TextureUsage.TEXTURE_BINDING,\n        GPUConst.TextureUsage.COPY_DST | GPUConst.TextureUsage.TEXTURE_BINDING,\n        GPUConst.TextureUsage.COPY_SRC | GPUConst.TextureUsage.COPY_DST,\n      ])\n  )\n  .fn(async t => {\n    const { usage, method, size, dimension } = t.params;\n\n    const texture = t.device.createTexture({\n      size,\n      dimension,\n      format: 'rgba8unorm',\n      usage,\n    });\n\n    const success =\n      method === 'CopyT2B'\n        ? (usage & GPUTextureUsage.COPY_SRC) !== 0\n        : (usage & GPUTextureUsage.COPY_DST) !== 0;\n\n    t.testRun(\n      { texture },\n      { bytesPerRow: 0 },\n      { width: 0, height: 0, depthOrArrayLayers: 0 },\n      { dataSize: 1, method, success }\n    );\n  });\n\ng.test('sample_count')\n  .desc(\n    `\nTest that multisampled textures cannot be copied.\n- for various copy methods\n- multisampled or not\n\nNote: we don't test 1D, 2D array and 3D textures because multisample is not supported them.\n`\n  )\n  .params(u =>\n    u //\n      .combine('method', kImageCopyTypes)\n      .beginSubcases()\n      .combine('sampleCount', [1, 4])\n  )\n  .fn(async t => {\n    const { sampleCount, method } = t.params;\n\n    const texture = t.device.createTexture({\n      size: { width: 4, height: 4, depthOrArrayLayers: 1 },\n      sampleCount,\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST | GPUTextureUsage.TEXTURE_BINDING,\n    });\n\n    const success = sampleCount === 1;\n\n    t.testRun(\n      { texture },\n      { bytesPerRow: 0 },\n      { width: 0, height: 0, depthOrArrayLayers: 0 },\n      { dataSize: 1, method, success }\n    );\n  });\n\ng.test('mip_level')\n  .desc(\n    `\nTest that the mipLevel of the copy must be in range of the texture.\n- for various copy methods\n- for various dimensions\n- for several mipLevelCounts\n- for several target/source mipLevels`\n  )\n  .params(u =>\n    u\n      .combine('method', kImageCopyTypes)\n      .combineWithParams([\n        { dimension: '1d', size: [32, 1, 1] },\n        { dimension: '2d', size: [32, 32, 1] },\n        { dimension: '2d', size: [32, 32, 3] },\n        { dimension: '3d', size: [32, 32, 3] },\n      ] as const)\n      .beginSubcases()\n      .combine('mipLevelCount', [1, 3, 5])\n      .unless(p => p.dimension === '1d' && p.mipLevelCount !== 1)\n      .combine('mipLevel', [0, 1, 3, 4])\n  )\n  .fn(async t => {\n    const { mipLevelCount, mipLevel, method, size, dimension } = t.params;\n\n    const texture = t.device.createTexture({\n      size,\n      dimension,\n      mipLevelCount,\n      format: 'rgba8unorm',\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n    });\n\n    const success = mipLevel < mipLevelCount;\n\n    t.testRun(\n      { texture, mipLevel },\n      { bytesPerRow: 0 },\n      { width: 0, height: 0, depthOrArrayLayers: 0 },\n      { dataSize: 1, method, success }\n    );\n  });\n\ng.test('format')\n  .desc(\n    `\nTest the copy must be a full subresource if the texture's format is depth/stencil format.\n- for various copy methods\n- for various dimensions\n- for all sized formats\n- for a couple target/source mipLevels\n- for some modifier (or not) for the full copy size\n`\n  )\n  .params(u =>\n    u //\n      .combine('method', kImageCopyTypes)\n      .combineWithParams([\n        { depthOrArrayLayers: 1, dimension: '1d' },\n        { depthOrArrayLayers: 1, dimension: '2d' },\n        { depthOrArrayLayers: 3, dimension: '2d' },\n        { depthOrArrayLayers: 32, dimension: '3d' },\n      ] as const)\n      .combine('format', kSizedTextureFormats)\n      .filter(({ dimension, format }) => textureDimensionAndFormatCompatible(dimension, format))\n      .filter(formatCopyableWithMethod)\n      .beginSubcases()\n      .combine('mipLevel', [0, 2])\n      .unless(p => p.dimension === '1d' && p.mipLevel !== 0)\n      .combine('copyWidthModifier', [0, -1])\n      .combine('copyHeightModifier', [0, -1])\n      // If the texture has multiple depth/array slices and it is not a 3D texture, which means it is an array texture,\n      // depthModifier is not needed upon the third dimension. Because different layers are different subresources in\n      // an array texture. Whether it is a full copy or non-full copy doesn't make sense across different subresources.\n      // However, different depth slices on the same mip level are within the same subresource for a 3d texture. So we\n      // need to examine depth dimension via copyDepthModifier to determine whether it is a full copy for a 3D texture.\n      .expand('copyDepthModifier', ({ dimension: d }) => (d === '3d' ? [0, -1] : [0]))\n  )\n  .beforeAllSubcases(async t => {\n    const info = kTextureFormatInfo[t.params.format];\n    await t.selectDeviceOrSkipTestCase(info.feature);\n  })\n  .fn(async t => {\n    const {\n      method,\n      depthOrArrayLayers,\n      dimension,\n      format,\n      mipLevel,\n      copyWidthModifier,\n      copyHeightModifier,\n      copyDepthModifier,\n    } = t.params;\n\n    const info = kTextureFormatInfo[format];\n    const size = { width: 32 * info.blockWidth, height: 32 * info.blockHeight, depthOrArrayLayers };\n    if (dimension === '1d') {\n      size.height = 1;\n    }\n\n    const texture = t.device.createTexture({\n      size,\n      dimension,\n      format,\n      mipLevelCount: dimension === '1d' ? 1 : 5,\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n    });\n\n    let success = true;\n    if (\n      (info.depth || info.stencil) &&\n      (copyWidthModifier !== 0 || copyHeightModifier !== 0 || copyDepthModifier !== 0)\n    ) {\n      success = false;\n    }\n\n    const levelSize = virtualMipSize(\n      dimension,\n      [size.width, size.height, size.depthOrArrayLayers],\n      mipLevel\n    );\n    const copySize = [\n      levelSize[0] + copyWidthModifier * info.blockWidth,\n      levelSize[1] + copyHeightModifier * info.blockHeight,\n      // Note that compressed format is not supported for 3D textures yet, so there is no info.blockDepth.\n      levelSize[2] + copyDepthModifier,\n    ];\n\n    t.testRun(\n      { texture, mipLevel, aspect: getACopyableAspectWithMethod({ format, method }) },\n      { bytesPerRow: 512, rowsPerImage: 32 },\n      copySize,\n      {\n        dataSize: 512 * 32 * 32,\n        method,\n        success,\n      }\n    );\n  });\n\ng.test('origin_alignment')\n  .desc(\n    `\nTest that the texture copy origin must be aligned to the format's block size.\n- for various copy methods\n- for all color formats (depth stencil formats require a full copy)\n- for X, Y and Z coordinates\n- for various values for that coordinate depending on the block size\n`\n  )\n  .params(u =>\n    u\n      .combine('method', kImageCopyTypes)\n      // No need to test depth/stencil formats because its copy origin must be [0, 0, 0], which is already aligned with block size.\n      .combine('format', kColorTextureFormats)\n      .filter(formatCopyableWithMethod)\n      .combineWithParams([\n        { depthOrArrayLayers: 1, dimension: '1d' },\n        { depthOrArrayLayers: 1, dimension: '2d' },\n        { depthOrArrayLayers: 3, dimension: '2d' },\n        { depthOrArrayLayers: 3, dimension: '3d' },\n      ] as const)\n      .filter(({ dimension, format }) => textureDimensionAndFormatCompatible(dimension, format))\n      .beginSubcases()\n      .combine('coordinateToTest', ['x', 'y', 'z'] as const)\n      .unless(p => p.dimension === '1d' && p.coordinateToTest !== 'x')\n      .expand('valueToCoordinate', texelBlockAlignmentTestExpanderForValueToCoordinate)\n  )\n  .beforeAllSubcases(async t => {\n    const info = kTextureFormatInfo[t.params.format];\n    await t.selectDeviceOrSkipTestCase(info.feature);\n  })\n  .fn(async t => {\n    const {\n      valueToCoordinate,\n      coordinateToTest,\n      format,\n      method,\n      depthOrArrayLayers,\n      dimension,\n    } = t.params;\n    const info = kTextureFormatInfo[format];\n    const size = { width: 0, height: 0, depthOrArrayLayers };\n    const origin = { x: 0, y: 0, z: 0 };\n    let success = true;\n\n    origin[coordinateToTest] = valueToCoordinate;\n    switch (coordinateToTest) {\n      case 'x': {\n        success = origin.x % info.blockWidth === 0;\n        break;\n      }\n      case 'y': {\n        success = origin.y % info.blockHeight === 0;\n        break;\n      }\n    }\n\n    const texture = t.createAlignedTexture(format, size, origin, dimension);\n\n    t.testRun({ texture, origin }, { bytesPerRow: 0, rowsPerImage: 0 }, size, {\n      dataSize: 1,\n      method,\n      success,\n    });\n  });\n\ng.test('size_alignment')\n  .desc(\n    `\nTest that the copy size must be aligned to the texture's format's block size.\n- for various copy methods\n- for all formats (depth-stencil formats require a full copy)\n- for all texture dimensions\n- for the size's parameters to test (width / height / depth)\n- for various values for that copy size parameters, depending on the block size\n`\n  )\n  .params(u =>\n    u\n      .combine('method', kImageCopyTypes)\n      // No need to test depth/stencil formats because its copy size must be subresource's size, which is already aligned with block size.\n      .combine('format', kColorTextureFormats)\n      .filter(formatCopyableWithMethod)\n      .combine('dimension', kTextureDimensions)\n      .filter(({ dimension, format }) => textureDimensionAndFormatCompatible(dimension, format))\n      .beginSubcases()\n      .combine('coordinateToTest', ['width', 'height', 'depthOrArrayLayers'] as const)\n      .unless(p => p.dimension === '1d' && p.coordinateToTest !== 'width')\n      .expand('valueToCoordinate', texelBlockAlignmentTestExpanderForValueToCoordinate)\n  )\n  .beforeAllSubcases(async t => {\n    const info = kTextureFormatInfo[t.params.format];\n    await t.selectDeviceOrSkipTestCase(info.feature);\n  })\n  .fn(async t => {\n    const { valueToCoordinate, coordinateToTest, dimension, format, method } = t.params;\n    const info = kTextureFormatInfo[format];\n    const size = { width: 0, height: 0, depthOrArrayLayers: 0 };\n    const origin = { x: 0, y: 0, z: 0 };\n    let success = true;\n\n    size[coordinateToTest] = valueToCoordinate;\n    switch (coordinateToTest) {\n      case 'width': {\n        success = size.width % info.blockWidth === 0;\n        break;\n      }\n      case 'height': {\n        success = size.height % info.blockHeight === 0;\n        break;\n      }\n    }\n\n    const texture = t.createAlignedTexture(format, size, origin, dimension);\n\n    const bytesPerRow = align(\n      Math.max(1, Math.ceil(size.width / info.blockWidth)) * info.bytesPerBlock,\n      256\n    );\n    const rowsPerImage = Math.ceil(size.height / info.blockHeight);\n    t.testRun({ texture, origin }, { bytesPerRow, rowsPerImage }, size, {\n      dataSize: 1,\n      method,\n      success,\n    });\n  });\n\ng.test('copy_rectangle')\n  .desc(\n    `\nTest that the max corner of the copy rectangle (origin+copySize) must be inside the texture.\n- for various copy methods\n- for all dimensions\n- for the X, Y and Z dimensions\n- for various origin and copy size values (and texture sizes)\n- for various mip levels\n`\n  )\n  .params(u =>\n    u\n      .combine('method', kImageCopyTypes)\n      .combine('dimension', kTextureDimensions)\n      .beginSubcases()\n      .combine('originValue', [7, 8])\n      .combine('copySizeValue', [7, 8])\n      .combine('textureSizeValue', [14, 15])\n      .combine('mipLevel', [0, 2])\n      .combine('coordinateToTest', [0, 1, 2] as const)\n      .unless(p => p.dimension === '1d' && (p.coordinateToTest !== 0 || p.mipLevel !== 0))\n  )\n  .fn(async t => {\n    const {\n      originValue,\n      copySizeValue,\n      textureSizeValue,\n      mipLevel,\n      coordinateToTest,\n      method,\n      dimension,\n    } = t.params;\n    const format = 'rgba8unorm';\n    const info = kTextureFormatInfo[format];\n\n    const origin = [0, 0, 0];\n    const copySize = [0, 0, 0];\n    const textureSize = { width: 16 << mipLevel, height: 16 << mipLevel, depthOrArrayLayers: 16 };\n    if (dimension === '1d') {\n      textureSize.height = 1;\n      textureSize.depthOrArrayLayers = 1;\n    }\n    const success = originValue + copySizeValue <= textureSizeValue;\n\n    origin[coordinateToTest] = originValue;\n    copySize[coordinateToTest] = copySizeValue;\n    switch (coordinateToTest) {\n      case 0: {\n        textureSize.width = textureSizeValue << mipLevel;\n        break;\n      }\n      case 1: {\n        textureSize.height = textureSizeValue << mipLevel;\n        break;\n      }\n      case 2: {\n        textureSize.depthOrArrayLayers =\n          dimension === '3d' ? textureSizeValue << mipLevel : textureSizeValue;\n        break;\n      }\n    }\n\n    const texture = t.device.createTexture({\n      size: textureSize,\n      dimension,\n      mipLevelCount: dimension === '1d' ? 1 : 3,\n      format,\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n    });\n\n    assert(copySize[0] % info.blockWidth === 0);\n    const bytesPerRow = align(copySize[0] / info.blockWidth, 256);\n    assert(copySize[1] % info.blockHeight === 0);\n    const rowsPerImage = copySize[1] / info.blockHeight;\n    t.testRun({ texture, origin, mipLevel }, { bytesPerRow, rowsPerImage }, copySize, {\n      dataSize: 1,\n      method,\n      success,\n    });\n  });\n"],"file":"texture_related.spec.js"}