{"version":3,"sources":["../../../../src/webgpu/api/validation/createRenderPipeline.spec.ts"],"names":["description","makeTestGroup","unreachable","kTextureFormats","kRenderableColorTextureFormats","kTextureFormatInfo","kTexelRepresentationInfo","ValidationTest","F","getFragmentShaderCode","sampleType","componentCount","v","fragColorType","suffix","outputType","result","getDescriptor","options","defaultTargets","format","topology","targets","sampleCount","depthStencil","fragmentShaderCode","noFragment","vertex","module","device","createShaderModule","code","entryPoint","fragment","undefined","layout","getPipelineLayout","primitive","multisample","count","createPipelineLayout","bindGroupLayouts","createTexture","params","size","width","height","depthOrArrayLayers","usage","GPUTextureUsage","RENDER_ATTACHMENT","doCreateRenderPipelineTest","isAsync","_success","descriptor","shouldResolve","createRenderPipelineAsync","shouldReject","expectValidationError","createRenderPipeline","g","test","u","combine","fn","t","desc","beginSubcases","depthStencilFormat","haveColor","depthStencilState","goodDescriptor","badDescriptor","info","selectDeviceOrSkipTestCase","feature","renderable","color","combineWithParams","componentOrder","length","colorSrcFactor","colorDstFactor","alphaSrcFactor","alphaDstFactor","blend","srcFactor","dstFactor","operation","alpha","colorBlendReadsSrcAlpha","includes","meetsExtraBlendingRequirement","paramsSubcasesOnly","mismatched","selectMismatchedDeviceOrSkipTestCase","layoutDescriptor","mismatchedDevice","vertex_mismatched","fragment_mismatched"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAvBO,CAyBP,SAASC,aAAT,QAA8B,yCAA9B;AACA,SAASC,WAAT,QAA4B,8BAA5B;AACA;AACEC,eADF;AAEEC,8BAFF;AAGEC,kBAHF;AAIO,0BAJP;AAKA,SAASC,wBAAT,QAAyC,kCAAzC;;AAEA,SAASC,cAAT,QAA+B,sBAA/B;;AAEA,MAAMC,CAAN,SAAgBD,cAAhB,CAA+B;AAC7BE,EAAAA,qBAAqB,CAACC,UAAD,EAAmCC,cAAnC,EAAmE;AACtF,UAAMC,CAAC,GAAG,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,GAAhB,CAAV;;AAEA,QAAIC,aAAJ;AACA,QAAIC,MAAJ;AACA,YAAQJ,UAAR;AACE,WAAK,MAAL;AACEG,QAAAA,aAAa,GAAG,KAAhB;AACAC,QAAAA,MAAM,GAAG,EAAT;AACA;AACF,WAAK,MAAL;AACED,QAAAA,aAAa,GAAG,KAAhB;AACAC,QAAAA,MAAM,GAAG,GAAT;AACA;AACF;AACED,QAAAA,aAAa,GAAG,KAAhB;AACAC,QAAAA,MAAM,GAAG,IAAT;AACA,cAZJ;;;AAeA,QAAIC,UAAJ;AACA,QAAIC,MAAJ;AACA,YAAQL,cAAR;AACE,WAAK,CAAL;AACEI,QAAAA,UAAU,GAAGF,aAAb;AACAG,QAAAA,MAAM,GAAI,GAAEJ,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,EAA1B;AACA;AACF,WAAK,CAAL;AACEC,QAAAA,UAAU,GAAI,QAAOF,aAAc,GAAnC;AACAG,QAAAA,MAAM,GAAI,GAAED,UAAW,IAAGH,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,KAAIF,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,GAA1D;AACA;AACF,WAAK,CAAL;AACEC,QAAAA,UAAU,GAAI,QAAOF,aAAc,GAAnC;AACAG,QAAAA,MAAM,GAAI,GAAED,UAAW,IAAGH,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,KAAIF,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,KAAIF,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,GAA5E;AACA;AACF,WAAK,CAAL;AACEC,QAAAA,UAAU,GAAI,QAAOF,aAAc,GAAnC;AACAG,QAAAA,MAAM,GAAI,GAAED,UAAW,IAAGH,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,KAAIF,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,KAAIF,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,KAAIF,CAAC,CAAC,CAAD,CAAI,GAAEE,MAAO,GAA9F;AACA;AACF;AACEZ,QAAAA,WAAW,GAlBf;;;AAqBA,WAAQ;AACZ,uDAAuDa,UAAW;AAClE,eAAeC,MAAO;AACtB,MAHI;AAID;;AAEDC,EAAAA,aAAa;AACXC,EAAAA,OAOC;;;;;;;AAAG,IARO;AASkB;AAC7B,UAAMC,cAAqC,GAAG,CAAC,EAAEC,MAAM,EAAE,YAAV,EAAD,CAA9C;AACA,UAAM;AACJC,MAAAA,QAAQ,GAAG,eADP;AAEJC,MAAAA,OAAO,GAAGH,cAFN;AAGJI,MAAAA,WAAW,GAAG,CAHV;AAIJC,MAAAA,YAJI;AAKJC,MAAAA,kBAAkB,GAAG,KAAKhB,qBAAL;AACnBJ,MAAAA,kBAAkB,CAACiB,OAAO,CAAC,CAAD,CAAP,GAAaA,OAAO,CAAC,CAAD,CAAP,CAAWF,MAAxB,GAAiC,YAAlC,CAAlB,CAAkEV,UAD/C;AAEnB,OAFmB,CALjB;;AASJgB,MAAAA,UAAU,GAAG,KATT;AAUFR,IAAAA,OAVJ;;AAYA,WAAO;AACLS,MAAAA,MAAM,EAAE;AACNC,QAAAA,MAAM,EAAE,KAAKC,MAAL,CAAYC,kBAAZ,CAA+B;AACrCC,UAAAA,IAAI,EAAG;AACjB;AACA;AACA,cAJ+C,EAA/B,CADF;;AAONC,QAAAA,UAAU,EAAE,MAPN,EADH;;AAULC,MAAAA,QAAQ,EAAEP,UAAU;AAChBQ,MAAAA,SADgB;AAEhB;AACEN,QAAAA,MAAM,EAAE,KAAKC,MAAL,CAAYC,kBAAZ,CAA+B;AACrCC,UAAAA,IAAI,EAAEN,kBAD+B,EAA/B,CADV;;AAIEO,QAAAA,UAAU,EAAE,MAJd;AAKEV,QAAAA,OALF,EAZC;;AAmBLa,MAAAA,MAAM,EAAE,KAAKC,iBAAL,EAnBH;AAoBLC,MAAAA,SAAS,EAAE,EAAEhB,QAAF,EApBN;AAqBLiB,MAAAA,WAAW,EAAE,EAAEC,KAAK,EAAEhB,WAAT,EArBR;AAsBLC,MAAAA,YAtBK,EAAP;;AAwBD;;AAEDY,EAAAA,iBAAiB,GAAsB;AACrC,WAAO,KAAKP,MAAL,CAAYW,oBAAZ,CAAiC,EAAEC,gBAAgB,EAAE,EAApB,EAAjC,CAAP;AACD;;AAEDC,EAAAA,aAAa,CAACC,MAAD,EAAwE;AACnF,UAAM,EAAEvB,MAAF,EAAUG,WAAV,KAA0BoB,MAAhC;;AAEA,WAAO,KAAKd,MAAL,CAAYa,aAAZ,CAA0B;AAC/BE,MAAAA,IAAI,EAAE,EAAEC,KAAK,EAAE,CAAT,EAAYC,MAAM,EAAE,CAApB,EAAuBC,kBAAkB,EAAE,CAA3C,EADyB;AAE/BC,MAAAA,KAAK,EAAEC,eAAe,CAACC,iBAFQ;AAG/B9B,MAAAA,MAH+B;AAI/BG,MAAAA,WAJ+B,EAA1B,CAAP;;AAMD;;AAED4B,EAAAA,0BAA0B;AACxBC,EAAAA,OADwB;AAExBC,EAAAA,QAFwB;AAGxBC,EAAAA,UAHwB;AAIxB;AACA,QAAIF,OAAJ,EAAa;AACX,UAAIC,QAAJ,EAAc;AACZ,aAAKE,aAAL,CAAmB,KAAK1B,MAAL,CAAY2B,yBAAZ,CAAsCF,UAAtC,CAAnB;AACD,OAFD,MAEO;AACL,aAAKG,YAAL,CAAkB,gBAAlB,EAAoC,KAAK5B,MAAL,CAAY2B,yBAAZ,CAAsCF,UAAtC,CAApC;AACD;AACF,KAND,MAMO;AACL,WAAKI,qBAAL,CAA2B,MAAM;AAC/B,aAAK7B,MAAL,CAAY8B,oBAAZ,CAAiCL,UAAjC;AACD,OAFD,EAEG,CAACD,QAFJ;AAGD;AACF,GAlI4B;;;AAqI/B,OAAO,MAAMO,CAAC,GAAG3D,aAAa,CAACO,CAAD,CAAvB;;AAEPoD,CAAC,CAACC,IAAF,CAAO,mCAAP;AACGlB,MADH,CACUmB,CAAC,IAAIA,CAAC,CAACC,OAAF,CAAU,SAAV,EAAqB,CAAC,KAAD,EAAQ,IAAR,CAArB,CADf;AAEGC,EAFH,CAEM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,KAAca,CAAC,CAACtB,MAAtB;AACA,QAAMW,UAAU,GAAGW,CAAC,CAAChD,aAAF,EAAnB;;AAEAgD,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsC,IAAtC,EAA4CE,UAA5C;AACD,CAPH;;AASAM,CAAC,CAACC,IAAF,CAAO,8DAAP;AACGK,IADH;AAEK;AACL,6FAHA;;AAKGvB,MALH,CAKU,CAAAmB,CAAC;AACPA,CAAC;AACEC,OADH,CACW,SADX,EACsB,CAAC,KAAD,EAAQ,IAAR,CADtB;AAEGI,aAFH;AAGGJ,OAHH,CAGW,oBAHX,EAGiC;AAC7B,aAD6B;AAE7B,sBAF6B;AAG7B,cAH6B;AAI7B,EAJ6B,CAHjC;;AASGA,OATH,CASW,WATX,EASwB,CAAC,KAAD,EAAQ,IAAR,CATxB,CANJ;;AAiBGC,EAjBH,CAiBM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,EAAWgB,kBAAX,EAA+BC,SAA/B,KAA6CJ,CAAC,CAACtB,MAArD;;AAEA,MAAI2B,iBAAJ;AACA,MAAIF,kBAAkB,KAAK,EAA3B,EAA+B;AAC7BE,IAAAA,iBAAiB,GAAGpC,SAApB;AACD,GAFD,MAEO;AACLoC,IAAAA,iBAAiB,GAAG,EAAElD,MAAM,EAAEgD,kBAAV,EAApB;AACD;;AAED;AACA;AACA,QAAMd,UAAU,GAAGW,CAAC,CAAChD,aAAF,CAAgB;AACjCS,IAAAA,UAAU,EAAE,IADqB;AAEjCF,IAAAA,YAAY,EAAE8C,iBAFmB;AAGjChD,IAAAA,OAAO,EAAE+C,SAAS,GAAG,CAAC,EAAEjD,MAAM,EAAE,YAAV,EAAD,CAAH,GAAgC,EAHjB,EAAhB,CAAnB;;;AAMA6C,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsC,IAAtC,EAA4CE,UAA5C;AACD,CApCH;;AAsCAM,CAAC,CAACC,IAAF,CAAO,4DAAP;AACGlB,MADH,CACUmB,CAAC,IAAIA,CAAC,CAACC,OAAF,CAAU,SAAV,EAAqB,CAAC,KAAD,EAAQ,IAAR,CAArB,CADf;AAEGC,EAFH,CAEM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,KAAca,CAAC,CAACtB,MAAtB;;AAEA,QAAM4B,cAAc,GAAGN,CAAC,CAAChD,aAAF,CAAgB;AACrCK,IAAAA,OAAO,EAAE,CAAC,EAAEF,MAAM,EAAE,YAAV,EAAD,CAD4B,EAAhB,CAAvB;;;AAIA;AACA6C,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsC,IAAtC,EAA4CmB,cAA5C;;AAEA;AACA,QAAMC,aAAa,GAAGP,CAAC,CAAChD,aAAF,CAAgB;AACpCK,IAAAA,OAAO,EAAE,EAD2B,EAAhB,CAAtB;;;AAIA2C,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsC,KAAtC,EAA6CoB,aAA7C;AACD,CAlBH;;AAoBAZ,CAAC,CAACC,IAAF,CAAO,kCAAP;AACGlB,MADH,CACUmB,CAAC,IAAIA,CAAC,CAACC,OAAF,CAAU,SAAV,EAAqB,CAAC,KAAD,EAAQ,IAAR,CAArB,EAAoCA,OAApC,CAA4C,QAA5C,EAAsD5D,eAAtD,CADf;AAEG6D,EAFH,CAEM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,EAAWhC,MAAX,KAAsB6C,CAAC,CAACtB,MAA9B;AACA,QAAM8B,IAAI,GAAGpE,kBAAkB,CAACe,MAAD,CAA/B;AACA,QAAM6C,CAAC,CAACS,0BAAF,CAA6BD,IAAI,CAACE,OAAlC,CAAN;;AAEA,QAAMrB,UAAU,GAAGW,CAAC,CAAChD,aAAF,CAAgB,EAAEK,OAAO,EAAE,CAAC,EAAEF,MAAF,EAAD,CAAX,EAAhB,CAAnB;;AAEA6C,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsCqB,IAAI,CAACG,UAAL,IAAmBH,IAAI,CAACI,KAA9D,EAAqEvB,UAArE;AACD,CAVH;;AAYAM,CAAC,CAACC,IAAF,CAAO,4BAAP;AACGlB,MADH,CACU,CAAAmB,CAAC;AACPA,CAAC,CAACC,OAAF,CAAU,SAAV,EAAqB,CAAC,KAAD,EAAQ,IAAR,CAArB,EAAoCe,iBAApC,CAAsD;AACpD,EAAEvD,WAAW,EAAE,CAAf,EAAkB8B,QAAQ,EAAE,KAA5B,EADoD;AAEpD,EAAE9B,WAAW,EAAE,CAAf,EAAkB8B,QAAQ,EAAE,IAA5B,EAFoD;AAGpD,EAAE9B,WAAW,EAAE,CAAf,EAAkB8B,QAAQ,EAAE,KAA5B,EAHoD;AAIpD,EAAE9B,WAAW,EAAE,CAAf,EAAkB8B,QAAQ,EAAE,KAA5B,EAJoD;AAKpD,EAAE9B,WAAW,EAAE,CAAf,EAAkB8B,QAAQ,EAAE,IAA5B,EALoD;AAMpD,EAAE9B,WAAW,EAAE,CAAf,EAAkB8B,QAAQ,EAAE,KAA5B,EANoD;AAOpD,EAAE9B,WAAW,EAAE,EAAf,EAAmB8B,QAAQ,EAAE,KAA7B,EAPoD,CAAtD,CAFJ;;;AAYGW,EAZH,CAYM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,EAAW7B,WAAX,EAAwB8B,QAAxB,KAAqCY,CAAC,CAACtB,MAA7C;;AAEA,QAAMW,UAAU,GAAGW,CAAC,CAAChD,aAAF,CAAgB,EAAEM,WAAF,EAAhB,CAAnB;;AAEA0C,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsCC,QAAtC,EAAgDC,UAAhD;AACD,CAlBH;;AAoBAM,CAAC,CAACC,IAAF,CAAO,yBAAP;AACGK,IADH;AAEK;AACL;AACA;AACA;AACA,GANA;;AAQGvB,MARH,CAQU,CAAAmB,CAAC;AACPA,CAAC;AACEC,OADH,CACW,SADX,EACsB,CAAC,KAAD,EAAQ,IAAR,CADtB;AAEGA,OAFH,CAEW,QAFX,EAEqB3D,8BAFrB;AAGG+D,aAHH;AAIGJ,OAJH,CAIW,YAJX,EAIyB,CAAC,OAAD,EAAU,MAAV,EAAkB,MAAlB,CAJzB;AAKGA,OALH,CAKW,gBALX,EAK6B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAL7B,CATJ;;AAgBGC,EAhBH,CAgBM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,EAAWhC,MAAX,EAAmBV,UAAnB,EAA+BC,cAA/B,KAAkDsD,CAAC,CAACtB,MAA1D;AACA,QAAM8B,IAAI,GAAGpE,kBAAkB,CAACe,MAAD,CAA/B;AACA,QAAM6C,CAAC,CAACS,0BAAF,CAA6BD,IAAI,CAACE,OAAlC,CAAN;;AAEA,QAAMrB,UAAU,GAAGW,CAAC,CAAChD,aAAF,CAAgB;AACjCK,IAAAA,OAAO,EAAE,CAAC,EAAEF,MAAF,EAAD,CADwB;AAEjCK,IAAAA,kBAAkB,EAAEwC,CAAC,CAACxD,qBAAF,CAAwBC,UAAxB,EAAoCC,cAApC,CAFa,EAAhB,CAAnB;;;AAKA,QAAM0C,QAAQ;AACZoB,EAAAA,IAAI,CAAC/D,UAAL,KAAoBA,UAApB;AACAC,EAAAA,cAAc,IAAIL,wBAAwB,CAACc,MAAD,CAAxB,CAAiC2D,cAAjC,CAAgDC,MAFpE;AAGAf,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsCC,QAAtC,EAAgDC,UAAhD;AACD,CA9BH;;AAgCAM,CAAC,CAACC,IAAF,CAAO,+BAAP;AACGK,IADH;AAEK;AACL;AACA,GAJA;;AAMGvB,MANH,CAMU,CAAAmB,CAAC;AACPA,CAAC;AACEC,OADH,CACW,SADX,EACsB,CAAC,KAAD,EAAQ,IAAR,CADtB;AAEGA,OAFH,CAEW,QAFX,EAEqB,CAAC,SAAD,EAAY,UAAZ,EAAwB,YAAxB,EAAsC,YAAtC,CAFrB;AAGGI,aAHH;AAIGJ,OAJH,CAIW,gBAJX,EAI6B,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAJ7B;AAKGe,iBALH,CAKqB;AACjB;AACA;AACEG,EAAAA,cAAc,EAAE,KADlB;AAEEC,EAAAA,cAAc,EAAE,MAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,MAJlB,EAFiB;;AAQjB;AACEH,EAAAA,cAAc,EAAE,WADlB;AAEEC,EAAAA,cAAc,EAAE,MAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,MAJlB,EARiB;;AAcjB;AACA;AACEH,EAAAA,cAAc,EAAE,WADlB;AAEEC,EAAAA,cAAc,EAAE,KAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,MAJlB,EAfiB;;AAqBjB;AACEH,EAAAA,cAAc,EAAE,KADlB;AAEEC,EAAAA,cAAc,EAAE,qBAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,MAJlB,EArBiB;;AA2BjB;AACEH,EAAAA,cAAc,EAAE,qBADlB;AAEEC,EAAAA,cAAc,EAAE,KAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,MAJlB,EA3BiB;;AAiCjB;AACEH,EAAAA,cAAc,EAAE,KADlB;AAEEC,EAAAA,cAAc,EAAE,MAFlB;AAGEC,EAAAA,cAAc,EAAE,KAHlB;AAIEC,EAAAA,cAAc,EAAE,MAJlB,EAjCiB;;AAuCjB;AACEH,EAAAA,cAAc,EAAE,KADlB;AAEEC,EAAAA,cAAc,EAAE,MAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,KAJlB,EAvCiB;;AA6CjB;AACEH,EAAAA,cAAc,EAAE,KADlB;AAEEC,EAAAA,cAAc,EAAE,MAFlB;AAGEC,EAAAA,cAAc,EAAE,MAHlB;AAIEC,EAAAA,cAAc,EAAE,WAJlB,EA7CiB,CALrB,CAPJ;;;;AAiEGpB,EAjEH,CAiEM,MAAMC,CAAN,IAAW;AACb,QAAMvD,UAAU,GAAG,OAAnB;AACA,QAAM;AACJ0C,IAAAA,OADI;AAEJhC,IAAAA,MAFI;AAGJT,IAAAA,cAHI;AAIJsE,IAAAA,cAJI;AAKJC,IAAAA,cALI;AAMJC,IAAAA,cANI;AAOJC,IAAAA,cAPI;AAQFnB,EAAAA,CAAC,CAACtB,MARN;AASA,QAAM8B,IAAI,GAAGpE,kBAAkB,CAACe,MAAD,CAA/B;AACA,QAAM6C,CAAC,CAACS,0BAAF,CAA6BD,IAAI,CAACE,OAAlC,CAAN;;AAEA,QAAMrB,UAAU,GAAGW,CAAC,CAAChD,aAAF,CAAgB;AACjCK,IAAAA,OAAO,EAAE;AACP;AACEF,MAAAA,MADF;AAEEiE,MAAAA,KAAK,EAAE;AACLR,QAAAA,KAAK,EAAE;AACLS,UAAAA,SAAS,EAAEL,cADN;AAELM,UAAAA,SAAS,EAAEL,cAFN;AAGLM,UAAAA,SAAS,EAAE,KAHN,EADF;;AAMLC,QAAAA,KAAK,EAAE;AACLH,UAAAA,SAAS,EAAEH,cADN;AAELI,UAAAA,SAAS,EAAEH,cAFN;AAGLI,UAAAA,SAAS,EAAE,KAHN,EANF,EAFT,EADO,CADwB;;;;;AAkBjC/D,IAAAA,kBAAkB,EAAEwC,CAAC,CAACxD,qBAAF,CAAwBC,UAAxB,EAAoCC,cAApC,CAlBa,EAAhB,CAAnB;;;AAqBA,QAAM+E,uBAAuB;AAC3BT,EAAAA,cAAc,CAACU,QAAf,CAAwB,WAAxB,KAAwCT,cAAc,CAACS,QAAf,CAAwB,WAAxB,CAD1C;AAEA,QAAMC,6BAA6B,GAAG,CAACF,uBAAD,IAA4B/E,cAAc,KAAK,CAArF;AACA,QAAM0C,QAAQ;AACZoB,EAAAA,IAAI,CAAC/D,UAAL,KAAoBA,UAApB;AACAC,EAAAA,cAAc,IAAIL,wBAAwB,CAACc,MAAD,CAAxB,CAAiC2D,cAAjC,CAAgDC,MADlE;AAEAY,EAAAA,6BAHF;AAIA3B,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsCC,QAAtC,EAAgDC,UAAhD;AACD,CA5GH;;AA8GAM,CAAC,CAACC,IAAF,CAAO,iCAAP;AACGK,IADH;AAEI,uGAFJ;;AAIG2B,kBAJH,CAIsB/B,CAAC,IAAIA,CAAC,CAACC,OAAF,CAAU,SAAV,EAAqB,CAAC,IAAD,EAAO,KAAP,CAArB,EAAoCA,OAApC,CAA4C,YAA5C,EAA0D,CAAC,IAAD,EAAO,KAAP,CAA1D,CAJ3B;AAKGC,EALH,CAKM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,EAAW0C,UAAX,KAA0B7B,CAAC,CAACtB,MAAlC;;AAEA,MAAImD,UAAJ,EAAgB;AACd,UAAM7B,CAAC,CAAC8B,oCAAF,CAAuC7D,SAAvC,CAAN;AACD;;AAED,QAAM8D,gBAAgB,GAAG,EAAEvD,gBAAgB,EAAE,EAApB,EAAzB;AACA,QAAMN,MAAM,GAAG2D,UAAU;AACrB7B,EAAAA,CAAC,CAACgC,gBAAF,CAAmBzD,oBAAnB,CAAwCwD,gBAAxC,CADqB;AAErB/B,EAAAA,CAAC,CAACpC,MAAF,CAASW,oBAAT,CAA8BwD,gBAA9B,CAFJ;;AAIA,QAAM1C,UAAU,GAAG;AACjBnB,IAAAA,MADiB;AAEjBR,IAAAA,MAAM,EAAE;AACNC,MAAAA,MAAM,EAAEqC,CAAC,CAACpC,MAAF,CAASC,kBAAT,CAA4B;AAClCC,QAAAA,IAAI,EAAG;AACjB;AACA;AACA;AACA,OAL4C,EAA5B,CADF;;AAQNC,MAAAA,UAAU,EAAE,MARN,EAFS;;AAYjBC,IAAAA,QAAQ,EAAE;AACRL,MAAAA,MAAM,EAAEqC,CAAC,CAACpC,MAAF,CAASC,kBAAT,CAA4B,EAAEC,IAAI,EAAEkC,CAAC,CAACxD,qBAAF,CAAwB,OAAxB,EAAiC,CAAjC,CAAR,EAA5B,CADA;AAERuB,MAAAA,UAAU,EAAE,MAFJ;AAGRV,MAAAA,OAAO,EAAE,CAAC,EAAEF,MAAM,EAAE,YAAV,EAAD,CAHD,EAZO,EAAnB;;;;AAmBA6C,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsC,CAAC0C,UAAvC,EAAmDxC,UAAnD;AACD,CArCH;;AAuCAM,CAAC,CAACC,IAAF,CAAO,+BAAP;AACGK,IADH;AAEI,qGAFJ;;AAIG2B,kBAJH,CAIsB,CAAA/B,CAAC;AACnBA,CAAC,CAACC,OAAF,CAAU,SAAV,EAAqB,CAAC,IAAD,EAAO,KAAP,CAArB,EAAoCe,iBAApC,CAAsD;AACpD,EAAEoB,iBAAiB,EAAE,KAArB,EAA4BC,mBAAmB,EAAE,KAAjD,EAAwD9C,QAAQ,EAAE,IAAlE,EADoD;AAEpD,EAAE6C,iBAAiB,EAAE,IAArB,EAA2BC,mBAAmB,EAAE,KAAhD,EAAuD9C,QAAQ,EAAE,KAAjE,EAFoD;AAGpD,EAAE6C,iBAAiB,EAAE,KAArB,EAA4BC,mBAAmB,EAAE,IAAjD,EAAuD9C,QAAQ,EAAE,KAAjE,EAHoD,CAAtD,CALJ;;;AAWGW,EAXH,CAWM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEb,OAAF,EAAW8C,iBAAX,EAA8BC,mBAA9B,EAAmD9C,QAAnD,KAAgEY,CAAC,CAACtB,MAAxE;;AAEA,MAAIuD,iBAAiB,IAAIC,mBAAzB,EAA8C;AAC5C,UAAMlC,CAAC,CAAC8B,oCAAF,CAAuC7D,SAAvC,CAAN;AACD;;AAED,QAAMH,IAAI,GAAI;AAClB;AACA;AACA;AACA,KAJI;;AAMA,QAAMuB,UAAU,GAAG;AACjB3B,IAAAA,MAAM,EAAE;AACNC,MAAAA,MAAM,EAAEsE,iBAAiB;AACrBjC,MAAAA,CAAC,CAACgC,gBAAF,CAAmBnE,kBAAnB,CAAsC,EAAEC,IAAF,EAAtC,CADqB;AAErBkC,MAAAA,CAAC,CAACpC,MAAF,CAASC,kBAAT,CAA4B,EAAEC,IAAF,EAA5B,CAHE;AAINC,MAAAA,UAAU,EAAE,MAJN,EADS;;AAOjBC,IAAAA,QAAQ,EAAE;AACRL,MAAAA,MAAM,EAAEuE,mBAAmB;AACvBlC,MAAAA,CAAC,CAACgC,gBAAF,CAAmBnE,kBAAnB,CAAsC,EAAEC,IAAI,EAAEkC,CAAC,CAACxD,qBAAF,CAAwB,OAAxB,EAAiC,CAAjC,CAAR,EAAtC,CADuB;AAEvBwD,MAAAA,CAAC,CAACpC,MAAF,CAASC,kBAAT,CAA4B,EAAEC,IAAI,EAAEkC,CAAC,CAACxD,qBAAF,CAAwB,OAAxB,EAAiC,CAAjC,CAAR,EAA5B,CAHI;AAIRuB,MAAAA,UAAU,EAAE,MAJJ;AAKRV,MAAAA,OAAO,EAAE,CAAC,EAAEF,MAAM,EAAE,YAAV,EAAD,CALD,EAPO;;AAcjBe,IAAAA,MAAM,EAAE8B,CAAC,CAAC7B,iBAAF,EAdS,EAAnB;;;AAiBA6B,EAAAA,CAAC,CAACd,0BAAF,CAA6BC,OAA7B,EAAsCC,QAAtC,EAAgDC,UAAhD;AACD,CA1CH","sourcesContent":["export const description = `\ncreateRenderPipeline and createRenderPipelineAsync validation tests.\n\nTODO: review existing tests, write descriptions, and make sure tests are complete.\n      Make sure the following is covered. Consider splitting the file if too large/disjointed.\n> - various attachment problems\n>\n> - interface matching between vertex and fragment shader\n>     - superset, subset, etc.\n>\n> - vertex stage {valid, invalid}\n> - fragment stage {valid, invalid}\n> - primitive topology all possible values\n> - rasterizationState various values\n> - multisample count {0, 1, 3, 4, 8, 16, 1024}\n> - multisample mask {0, 0xFFFFFFFF}\n> - alphaToCoverage:\n>     - alphaToCoverageEnabled is { true, false } and sampleCount { = 1, = 4 }.\n>       The only failing case is (true, 1).\n>     - output SV_Coverage semantics is statically used by fragmentStage and\n>       alphaToCoverageEnabled is { true (fails), false (passes) }.\n>     - sampleMask is being used and alphaToCoverageEnabled is { true (fails), false (passes) }.\n\n`;\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { unreachable } from '../../../common/util/util.js';\nimport {\n  kTextureFormats,\n  kRenderableColorTextureFormats,\n  kTextureFormatInfo,\n} from '../../capability_info.js';\nimport { kTexelRepresentationInfo } from '../../util/texture/texel_data.js';\n\nimport { ValidationTest } from './validation_test.js';\n\nclass F extends ValidationTest {\n  getFragmentShaderCode(sampleType: GPUTextureSampleType, componentCount: number): string {\n    const v = ['0', '1', '0', '1'];\n\n    let fragColorType;\n    let suffix;\n    switch (sampleType) {\n      case 'sint':\n        fragColorType = 'i32';\n        suffix = '';\n        break;\n      case 'uint':\n        fragColorType = 'u32';\n        suffix = 'u';\n        break;\n      default:\n        fragColorType = 'f32';\n        suffix = '.0';\n        break;\n    }\n\n    let outputType;\n    let result;\n    switch (componentCount) {\n      case 1:\n        outputType = fragColorType;\n        result = `${v[0]}${suffix}`;\n        break;\n      case 2:\n        outputType = `vec2<${fragColorType}>`;\n        result = `${outputType}(${v[0]}${suffix}, ${v[1]}${suffix})`;\n        break;\n      case 3:\n        outputType = `vec3<${fragColorType}>`;\n        result = `${outputType}(${v[0]}${suffix}, ${v[1]}${suffix}, ${v[2]}${suffix})`;\n        break;\n      case 4:\n        outputType = `vec4<${fragColorType}>`;\n        result = `${outputType}(${v[0]}${suffix}, ${v[1]}${suffix}, ${v[2]}${suffix}, ${v[3]}${suffix})`;\n        break;\n      default:\n        unreachable();\n    }\n\n    return `\n    [[stage(fragment)]] fn main() -> [[location(0)]] ${outputType} {\n      return ${result};\n    }`;\n  }\n\n  getDescriptor(\n    options: {\n      topology?: GPUPrimitiveTopology;\n      targets?: GPUColorTargetState[];\n      sampleCount?: number;\n      depthStencil?: GPUDepthStencilState;\n      fragmentShaderCode?: string;\n      noFragment?: boolean;\n    } = {}\n  ): GPURenderPipelineDescriptor {\n    const defaultTargets: GPUColorTargetState[] = [{ format: 'rgba8unorm' }];\n    const {\n      topology = 'triangle-list',\n      targets = defaultTargets,\n      sampleCount = 1,\n      depthStencil,\n      fragmentShaderCode = this.getFragmentShaderCode(\n        kTextureFormatInfo[targets[0] ? targets[0].format : 'rgba8unorm'].sampleType,\n        4\n      ),\n      noFragment = false,\n    } = options;\n\n    return {\n      vertex: {\n        module: this.device.createShaderModule({\n          code: `\n            [[stage(vertex)]] fn main() -> [[builtin(position)]] vec4<f32> {\n              return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n            }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: noFragment\n        ? undefined\n        : {\n            module: this.device.createShaderModule({\n              code: fragmentShaderCode,\n            }),\n            entryPoint: 'main',\n            targets,\n          },\n      layout: this.getPipelineLayout(),\n      primitive: { topology },\n      multisample: { count: sampleCount },\n      depthStencil,\n    };\n  }\n\n  getPipelineLayout(): GPUPipelineLayout {\n    return this.device.createPipelineLayout({ bindGroupLayouts: [] });\n  }\n\n  createTexture(params: { format: GPUTextureFormat; sampleCount: number }): GPUTexture {\n    const { format, sampleCount } = params;\n\n    return this.device.createTexture({\n      size: { width: 4, height: 4, depthOrArrayLayers: 1 },\n      usage: GPUTextureUsage.RENDER_ATTACHMENT,\n      format,\n      sampleCount,\n    });\n  }\n\n  doCreateRenderPipelineTest(\n    isAsync: boolean,\n    _success: boolean,\n    descriptor: GPURenderPipelineDescriptor\n  ) {\n    if (isAsync) {\n      if (_success) {\n        this.shouldResolve(this.device.createRenderPipelineAsync(descriptor));\n      } else {\n        this.shouldReject('OperationError', this.device.createRenderPipelineAsync(descriptor));\n      }\n    } else {\n      this.expectValidationError(() => {\n        this.device.createRenderPipeline(descriptor);\n      }, !_success);\n    }\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('basic_use_of_createRenderPipeline')\n  .params(u => u.combine('isAsync', [false, true]))\n  .fn(async t => {\n    const { isAsync } = t.params;\n    const descriptor = t.getDescriptor();\n\n    t.doCreateRenderPipelineTest(isAsync, true, descriptor);\n  });\n\ng.test('create_vertex_only_pipeline_with_without_depth_stencil_state')\n  .desc(\n    `Test creating vertex-only render pipeline. A vertex-only render pipeline have no fragment\nstate (and thus have no color state), and can be create with or without depth stencil state.`\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .beginSubcases()\n      .combine('depthStencilFormat', [\n        'depth24plus',\n        'depth24plus-stencil8',\n        'depth32float',\n        '',\n      ] as const)\n      .combine('haveColor', [false, true])\n  )\n  .fn(async t => {\n    const { isAsync, depthStencilFormat, haveColor } = t.params;\n\n    let depthStencilState: GPUDepthStencilState | undefined;\n    if (depthStencilFormat === '') {\n      depthStencilState = undefined;\n    } else {\n      depthStencilState = { format: depthStencilFormat };\n    }\n\n    // Having targets or not should have no effect in result, since it will not appear in the\n    // descriptor in vertex-only render pipeline\n    const descriptor = t.getDescriptor({\n      noFragment: true,\n      depthStencil: depthStencilState,\n      targets: haveColor ? [{ format: 'rgba8unorm' }] : [],\n    });\n\n    t.doCreateRenderPipelineTest(isAsync, true, descriptor);\n  });\n\ng.test('at_least_one_color_state_is_required_for_complete_pipeline')\n  .params(u => u.combine('isAsync', [false, true]))\n  .fn(async t => {\n    const { isAsync } = t.params;\n\n    const goodDescriptor = t.getDescriptor({\n      targets: [{ format: 'rgba8unorm' }],\n    });\n\n    // Control case\n    t.doCreateRenderPipelineTest(isAsync, true, goodDescriptor);\n\n    // Fail because lack of color states\n    const badDescriptor = t.getDescriptor({\n      targets: [],\n    });\n\n    t.doCreateRenderPipelineTest(isAsync, false, badDescriptor);\n  });\n\ng.test('color_formats_must_be_renderable')\n  .params(u => u.combine('isAsync', [false, true]).combine('format', kTextureFormats))\n  .fn(async t => {\n    const { isAsync, format } = t.params;\n    const info = kTextureFormatInfo[format];\n    await t.selectDeviceOrSkipTestCase(info.feature);\n\n    const descriptor = t.getDescriptor({ targets: [{ format }] });\n\n    t.doCreateRenderPipelineTest(isAsync, info.renderable && info.color, descriptor);\n  });\n\ng.test('sample_count_must_be_valid')\n  .params(u =>\n    u.combine('isAsync', [false, true]).combineWithParams([\n      { sampleCount: 0, _success: false },\n      { sampleCount: 1, _success: true },\n      { sampleCount: 2, _success: false },\n      { sampleCount: 3, _success: false },\n      { sampleCount: 4, _success: true },\n      { sampleCount: 8, _success: false },\n      { sampleCount: 16, _success: false },\n    ])\n  )\n  .fn(async t => {\n    const { isAsync, sampleCount, _success } = t.params;\n\n    const descriptor = t.getDescriptor({ sampleCount });\n\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('pipeline_output_targets')\n  .desc(\n    `Pipeline fragment output types must be compatible with target color state format\n  - The scalar type (f32, i32, or u32) must match the sample type of the format.\n  - The componentCount of the fragment output (e.g. f32, vec2, vec3, vec4) must not have fewer\n    channels than that of the color attachment texture formats. Extra components are allowed and are discarded.\n  `\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('format', kRenderableColorTextureFormats)\n      .beginSubcases()\n      .combine('sampleType', ['float', 'uint', 'sint'] as const)\n      .combine('componentCount', [1, 2, 3, 4])\n  )\n  .fn(async t => {\n    const { isAsync, format, sampleType, componentCount } = t.params;\n    const info = kTextureFormatInfo[format];\n    await t.selectDeviceOrSkipTestCase(info.feature);\n\n    const descriptor = t.getDescriptor({\n      targets: [{ format }],\n      fragmentShaderCode: t.getFragmentShaderCode(sampleType, componentCount),\n    });\n\n    const _success =\n      info.sampleType === sampleType &&\n      componentCount >= kTexelRepresentationInfo[format].componentOrder.length;\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('pipeline_output_targets,blend')\n  .desc(\n    `On top of requirements from pipeline_output_targets, when blending is enabled and alpha channel is read indicated by any blend factor, an extra requirement is added:\n  - fragment output must be vec4.\n  `\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('format', ['r8unorm', 'rg8unorm', 'rgba8unorm', 'bgra8unorm'] as const)\n      .beginSubcases()\n      .combine('componentCount', [1, 2, 3, 4])\n      .combineWithParams([\n        // extra requirement does not apply\n        {\n          colorSrcFactor: 'one',\n          colorDstFactor: 'zero',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'zero',\n        },\n        {\n          colorSrcFactor: 'dst-alpha',\n          colorDstFactor: 'zero',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'zero',\n        },\n        // extra requirement applies, fragment output must be vec4 (contain alpha channel)\n        {\n          colorSrcFactor: 'src-alpha',\n          colorDstFactor: 'one',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'zero',\n        },\n        {\n          colorSrcFactor: 'one',\n          colorDstFactor: 'one-minus-src-alpha',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'zero',\n        },\n        {\n          colorSrcFactor: 'src-alpha-saturated',\n          colorDstFactor: 'one',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'zero',\n        },\n        {\n          colorSrcFactor: 'one',\n          colorDstFactor: 'zero',\n          alphaSrcFactor: 'one',\n          alphaDstFactor: 'zero',\n        },\n        {\n          colorSrcFactor: 'one',\n          colorDstFactor: 'zero',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'src',\n        },\n        {\n          colorSrcFactor: 'one',\n          colorDstFactor: 'zero',\n          alphaSrcFactor: 'zero',\n          alphaDstFactor: 'src-alpha',\n        },\n      ] as const)\n  )\n  .fn(async t => {\n    const sampleType = 'float';\n    const {\n      isAsync,\n      format,\n      componentCount,\n      colorSrcFactor,\n      colorDstFactor,\n      alphaSrcFactor,\n      alphaDstFactor,\n    } = t.params;\n    const info = kTextureFormatInfo[format];\n    await t.selectDeviceOrSkipTestCase(info.feature);\n\n    const descriptor = t.getDescriptor({\n      targets: [\n        {\n          format,\n          blend: {\n            color: {\n              srcFactor: colorSrcFactor,\n              dstFactor: colorDstFactor,\n              operation: 'add',\n            },\n            alpha: {\n              srcFactor: alphaSrcFactor,\n              dstFactor: alphaDstFactor,\n              operation: 'add',\n            },\n          },\n        },\n      ],\n      fragmentShaderCode: t.getFragmentShaderCode(sampleType, componentCount),\n    });\n\n    const colorBlendReadsSrcAlpha =\n      colorSrcFactor.includes('src-alpha') || colorDstFactor.includes('src-alpha');\n    const meetsExtraBlendingRequirement = !colorBlendReadsSrcAlpha || componentCount === 4;\n    const _success =\n      info.sampleType === sampleType &&\n      componentCount >= kTexelRepresentationInfo[format].componentOrder.length &&\n      meetsExtraBlendingRequirement;\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('pipeline_layout,device_mismatch')\n  .desc(\n    'Tests createRenderPipeline(Async) cannot be called with a pipeline layout created from another device'\n  )\n  .paramsSubcasesOnly(u => u.combine('isAsync', [true, false]).combine('mismatched', [true, false]))\n  .fn(async t => {\n    const { isAsync, mismatched } = t.params;\n\n    if (mismatched) {\n      await t.selectMismatchedDeviceOrSkipTestCase(undefined);\n    }\n\n    const layoutDescriptor = { bindGroupLayouts: [] };\n    const layout = mismatched\n      ? t.mismatchedDevice.createPipelineLayout(layoutDescriptor)\n      : t.device.createPipelineLayout(layoutDescriptor);\n\n    const descriptor = {\n      layout,\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n        [[stage(vertex)]] fn main() -> [[builtin(position)]] vec4<f32> {\n          return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n        }\n      `,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({ code: t.getFragmentShaderCode('float', 4) }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm' }] as const,\n      },\n    };\n\n    t.doCreateRenderPipelineTest(isAsync, !mismatched, descriptor);\n  });\n\ng.test('shader_module,device_mismatch')\n  .desc(\n    'Tests createRenderPipeline(Async) cannot be called with a shader module created from another device'\n  )\n  .paramsSubcasesOnly(u =>\n    u.combine('isAsync', [true, false]).combineWithParams([\n      { vertex_mismatched: false, fragment_mismatched: false, _success: true },\n      { vertex_mismatched: true, fragment_mismatched: false, _success: false },\n      { vertex_mismatched: false, fragment_mismatched: true, _success: false },\n    ])\n  )\n  .fn(async t => {\n    const { isAsync, vertex_mismatched, fragment_mismatched, _success } = t.params;\n\n    if (vertex_mismatched || fragment_mismatched) {\n      await t.selectMismatchedDeviceOrSkipTestCase(undefined);\n    }\n\n    const code = `\n      [[stage(vertex)]] fn main() -> [[builtin(position)]] vec4<f32> {\n        return vec4<f32>(0.0, 0.0, 0.0, 1.0);\n      }\n    `;\n\n    const descriptor = {\n      vertex: {\n        module: vertex_mismatched\n          ? t.mismatchedDevice.createShaderModule({ code })\n          : t.device.createShaderModule({ code }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: fragment_mismatched\n          ? t.mismatchedDevice.createShaderModule({ code: t.getFragmentShaderCode('float', 4) })\n          : t.device.createShaderModule({ code: t.getFragmentShaderCode('float', 4) }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm' }] as const,\n      },\n      layout: t.getPipelineLayout(),\n    };\n\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n"],"file":"createRenderPipeline.spec.js"}