{"version":3,"sources":["../../../../../../src/webgpu/api/validation/capability_checks/features/query_types.spec.ts"],"names":["description","makeTestGroup","ValidationTest","g","test","desc","params","u","combine","fn","t","type","pipelineStatisticsQueryEnable","timestampQueryEnable","requiredFeatures","push","selectDeviceOrSkipTestCase","count","pipelineStatistics","shouldError","expectValidationError","device","createQuerySet"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAFO,CAIP,SAASC,aAAT,QAA8B,+CAA9B;AACA,SAASC,cAAT,QAA+B,0BAA/B;;AAEA,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,cAAD,CAAvB;;AAEPC,CAAC,CAACC,IAAF,CAAO,gBAAP;AACGC,IADH;AAEK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAXA;;AAaGC,MAbH,CAaU,CAAAC,CAAC;AACPA,CAAC;AACEC,OADH,CACW,MADX,EACmB,CAAC,WAAD,EAAc,qBAAd,EAAqC,WAArC,CADnB;AAEGA,OAFH,CAEW,+BAFX,EAE4C,CAAC,KAAD,EAAQ,IAAR,CAF5C;AAGGA,OAHH,CAGW,sBAHX,EAGmC,CAAC,KAAD,EAAQ,IAAR,CAHnC,CAdJ;;AAmBGC,EAnBH,CAmBM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEC,IAAF,EAAQC,6BAAR,EAAuCC,oBAAvC,KAAgEH,CAAC,CAACJ,MAAxE;;AAEA,QAAMQ,gBAAkC,GAAG,EAA3C;AACA,MAAIF,6BAAJ,EAAmC;AACjCE,IAAAA,gBAAgB,CAACC,IAAjB,CAAsB,2BAAtB;AACD;AACD,MAAIF,oBAAJ,EAA0B;AACxBC,IAAAA,gBAAgB,CAACC,IAAjB,CAAsB,iBAAtB;AACD;;AAED,QAAML,CAAC,CAACM,0BAAF,CAA6B,EAAEF,gBAAF,EAA7B,CAAN;;AAEA,QAAMG,KAAK,GAAG,CAAd;AACA,QAAMC,kBAAkB;AACtBP,EAAAA,IAAI,KAAK,qBAAT,GAAkC,CAAC,qBAAD,CAAlC,GAAuE,EADzE;AAEA,QAAMQ,WAAW;AACdR,EAAAA,IAAI,KAAK,qBAAT,IAAkC,CAACC,6BAApC;AACCD,EAAAA,IAAI,KAAK,WAAT,IAAwB,CAACE,oBAF5B;;AAIAH,EAAAA,CAAC,CAACU,qBAAF,CAAwB,MAAM;AAC5BV,IAAAA,CAAC,CAACW,MAAF,CAASC,cAAT,CAAwB,EAAEX,IAAF,EAAQM,KAAR,EAAeC,kBAAf,EAAxB;AACD,GAFD,EAEGC,WAFH;AAGD,CA1CH","sourcesContent":["export const description = `\nTests for capability checking for features enabling optional query types.\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('createQuerySet')\n  .desc(\n    `\nTests that creating query set shouldn't be valid without the required feature enabled.\n- createQuerySet\n  - type {occlusion, pipeline-statistics, timestamp}\n  - x= {pipeline statistics, timestamp} query {enable, disable}\n\nTODO: This test should expect *synchronous* exceptions, not validation errors, per\n<https://github.com/gpuweb/gpuweb/blob/main/design/ErrorConventions.md>.\nAs of this writing, the spec needs to be fixed as well.\n  `\n  )\n  .params(u =>\n    u\n      .combine('type', ['occlusion', 'pipeline-statistics', 'timestamp'] as const)\n      .combine('pipelineStatisticsQueryEnable', [false, true])\n      .combine('timestampQueryEnable', [false, true])\n  )\n  .fn(async t => {\n    const { type, pipelineStatisticsQueryEnable, timestampQueryEnable } = t.params;\n\n    const requiredFeatures: GPUFeatureName[] = [];\n    if (pipelineStatisticsQueryEnable) {\n      requiredFeatures.push('pipeline-statistics-query');\n    }\n    if (timestampQueryEnable) {\n      requiredFeatures.push('timestamp-query');\n    }\n\n    await t.selectDeviceOrSkipTestCase({ requiredFeatures });\n\n    const count = 1;\n    const pipelineStatistics =\n      type === 'pipeline-statistics' ? (['clipper-invocations'] as const) : ([] as const);\n    const shouldError =\n      (type === 'pipeline-statistics' && !pipelineStatisticsQueryEnable) ||\n      (type === 'timestamp' && !timestampQueryEnable);\n\n    t.expectValidationError(() => {\n      t.device.createQuerySet({ type, count, pipelineStatistics });\n    }, shouldError);\n  });\n"],"file":"query_types.spec.js"}