{"version":3,"sources":["../../../../src/webgpu/util/texture/texel_data.spec.ts"],"names":["description","makeTestGroup","assert","kEncodableTextureFormats","kTextureFormatInfo","GPUTest","kTexelRepresentationInfo","getSingleDataType","getComponentReadbackTraits","g","doTest","t","format","params","componentData","rep","texelData","pack","texture","device","createTexture","size","usage","GPUTextureUsage","COPY_DST","TEXTURE_BINDING","queue","writeTexture","bytesPerRow","byteLength","ReadbackTypedArray","shaderType","shader","componentOrder","map","C","join","toLowerCase","pipeline","createComputePipeline","layout","compute","module","createShaderModule","code","entryPoint","outputBuffer","createBuffer","length","GPUBufferUsage","STORAGE","COPY_SRC","bindGroup","createBindGroup","getBindGroupLayout","entries","binding","resource","createView","buffer","encoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","dispatchWorkgroups","end","submit","finish","expectGPUBufferValuesEqual","c","value","decode","undefined","makeParam","fn","R","componentInfo","bitLength","G","B","A","test","u","combine","filter","copyDst","color","beginSubcases","expand","max","Math","pow","floor","i","offset","range","desc"],"mappings":"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","sourcesContent":["export const description = 'Test helpers for texel data produce the expected data in the shader';\n\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { assert } from '../../../common/util/util.js';\nimport {\n  kEncodableTextureFormats,\n  kTextureFormatInfo,\n  EncodableTextureFormat,\n} from '../../capability_info.js';\nimport { GPUTest } from '../../gpu_test.js';\n\nimport {\n  kTexelRepresentationInfo,\n  getSingleDataType,\n  getComponentReadbackTraits,\n} from './texel_data.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nfunction doTest(\n  t: GPUTest & {\n    params: {\n      format: EncodableTextureFormat;\n      componentData: {\n        R?: number;\n        G?: number;\n        B?: number;\n        A?: number;\n      };\n    };\n  }\n) {\n  const { format } = t.params;\n  const componentData = t.params.componentData;\n\n  const rep = kTexelRepresentationInfo[format];\n  const texelData = rep.pack(componentData);\n  const texture = t.device.createTexture({\n    format,\n    size: [1, 1, 1],\n    usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.TEXTURE_BINDING,\n  });\n\n  t.device.queue.writeTexture(\n    { texture },\n    texelData,\n    {\n      bytesPerRow: texelData.byteLength,\n    },\n    [1]\n  );\n\n  const { ReadbackTypedArray, shaderType } = getComponentReadbackTraits(getSingleDataType(format));\n\n  const shader = `\n  @group(0) @binding(0) var tex : texture_2d<${shaderType}>;\n\n  struct Output {\n    ${rep.componentOrder.map(C => `result${C} : ${shaderType},`).join('\\n')}\n  };\n  @group(0) @binding(1) var<storage, read_write> output : Output;\n\n  @compute @workgroup_size(1)\n  fn main() {\n      var texel : vec4<${shaderType}> = textureLoad(tex, vec2<i32>(0, 0), 0);\n      ${rep.componentOrder.map(C => `output.result${C} = texel.${C.toLowerCase()};`).join('\\n')}\n      return;\n  }`;\n\n  const pipeline = t.device.createComputePipeline({\n    layout: 'auto',\n    compute: {\n      module: t.device.createShaderModule({\n        code: shader,\n      }),\n      entryPoint: 'main',\n    },\n  });\n\n  const outputBuffer = t.device.createBuffer({\n    size: rep.componentOrder.length * 4,\n    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,\n  });\n\n  const bindGroup = t.device.createBindGroup({\n    layout: pipeline.getBindGroupLayout(0),\n    entries: [\n      {\n        binding: 0,\n        resource: texture.createView(),\n      },\n      {\n        binding: 1,\n        resource: {\n          buffer: outputBuffer,\n        },\n      },\n    ],\n  });\n\n  const encoder = t.device.createCommandEncoder();\n  const pass = encoder.beginComputePass();\n  pass.setPipeline(pipeline);\n  pass.setBindGroup(0, bindGroup);\n  pass.dispatchWorkgroups(1);\n  pass.end();\n  t.device.queue.submit([encoder.finish()]);\n\n  t.expectGPUBufferValuesEqual(\n    outputBuffer,\n    new ReadbackTypedArray(\n      rep.componentOrder.map(c => {\n        const value = rep.decode(componentData)[c];\n        assert(value !== undefined);\n        return value;\n      })\n    )\n  );\n}\n\n// Make a test parameter by mapping a format and each component to a texel component\n// data value.\nfunction makeParam(\n  format: EncodableTextureFormat,\n  fn: (bitLength: number, index: number) => number\n) {\n  const rep = kTexelRepresentationInfo[format];\n  return {\n    R: rep.componentInfo.R ? fn(rep.componentInfo.R.bitLength, 0) : undefined,\n    G: rep.componentInfo.G ? fn(rep.componentInfo.G.bitLength, 1) : undefined,\n    B: rep.componentInfo.B ? fn(rep.componentInfo.B.bitLength, 2) : undefined,\n    A: rep.componentInfo.A ? fn(rep.componentInfo.A.bitLength, 3) : undefined,\n  };\n}\n\ng.test('unorm_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        return (\n          kTextureFormatInfo[format].copyDst &&\n          kTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'unorm'\n        );\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            return Math.floor(offset[i] * max(bitLength));\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('snorm_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        return (\n          kTextureFormatInfo[format].copyDst &&\n          kTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'snorm'\n        );\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength - 1) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength) - 1),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            const range = 2 * max(bitLength);\n            return -max(bitLength) + Math.floor(offset[i] * range);\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('uint_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        return (\n          kTextureFormatInfo[format].copyDst &&\n          kTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'uint'\n        );\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            return Math.floor(offset[i] * max(bitLength));\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('sint_texel_data_in_shader')\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        return (\n          kTextureFormatInfo[format].copyDst &&\n          kTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'sint'\n        );\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength - 1) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength) - 1),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            const range = 2 * max(bitLength);\n            return -max(bitLength) + Math.floor(offset[i] * range);\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('float_texel_data_in_shader')\n  .desc(\n    `\nTODO: Test NaN, Infinity, -Infinity [1]`\n  )\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        return (\n          kTextureFormatInfo[format].copyDst &&\n          kTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'float'\n        );\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n\n          // [1]: Test NaN, Infinity, -Infinity\n\n          // Test some values\n          makeParam(format, () => 0.1199951171875),\n          makeParam(format, () => 1.4072265625),\n          makeParam(format, () => 24928),\n          makeParam(format, () => -0.1319580078125),\n          makeParam(format, () => -323.25),\n          makeParam(format, () => -7440),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            return [24896, -0.1319580078125, -323.25, -234.375][i];\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('ufloat_texel_data_in_shader')\n  .desc(\n    `\nTODO: Test NaN, Infinity [1]`\n  )\n  .params(u =>\n    u\n      .combine('format', kEncodableTextureFormats)\n      .filter(({ format }) => {\n        return (\n          kTextureFormatInfo[format].copyDst &&\n          kTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'ufloat'\n        );\n      })\n      .beginSubcases()\n      .expand('componentData', ({ format }) => {\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n\n          // [2]: Test NaN, Infinity\n\n          // Test some values\n          makeParam(format, () => 0.119140625),\n          makeParam(format, () => 1.40625),\n          makeParam(format, () => 24896),\n\n          // Test scattered mixed values\n          makeParam(format, (bitLength, i) => {\n            return [24896, 1.40625, 0.119140625, 0.23095703125][i];\n          }),\n\n          // Test mixed values that are close in magnitude.\n          makeParam(format, (bitLength, i) => {\n            return [0.1337890625, 0.17919921875, 0.119140625, 0.125][i];\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n"],"file":"texel_data.spec.js"}