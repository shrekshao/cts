{"version":3,"sources":["../../../../src/webgpu/util/texture/texel_data.ts"],"names":["assert","unreachable","assertInIntegerRange","float32ToFloatBits","float32ToFloat16Bits","floatAsNormalizedInteger","gammaCompress","gammaDecompress","normalizedIntegerAsFloat","packRGB9E5UFloat","floatBitsToNumber","float16BitsToFloat32","floatBitsToNormalULPFromZero","kFloat32Format","kFloat16Format","numberToFloat32Bits","float32BitsToNumber","numberToFloatBits","clamp","signExtend","TexelComponent","makePerTexelComponent","components","value","values","c","applyEach","fn","Object","assign","undefined","encodeSRGB","R","G","B","kRGB","decodeSRGB","makeClampToRange","format","repr","kTexelRepresentationInfo","numericRange","x","componentOrder","smallComponentDataViews","Map","getComponentDataView","byteLength","buffer","ArrayBuffer","DataView","dataView","get","set","packComponents","bitLengths","componentDataTypes","bitLengthMap","totalBitLength","length","entries","reduce","acc","componentDataTypeMap","bitOffset","type","bitLength","byteOffset","Math","floor","ceil","setUint8","setUint16","setUint32","currentValue","getUint32","mask","bitsToClearRight","bitsToClearLeft","newValue","setInt8","setInt16","setInt32","setFloat32","unpackComponentsBits","byteView","index","shortView","Uint16Array","longView","Uint32Array","getUint8","getUint16","word","makeNormalizedInfo","opt","encodeNonSRGB","n","signed","decodeNonSRGB","numberToBitsNonSRGB","bitsToNumberNonSRGB","encode","decode","numberToBits","bitsToNumber","sRGB","bitsToULPFromZero","maxValue","max","dataType","componentInfo","pack","unpackBits","data","min","makeIntegerInfo","bitMask","v","makeFloatInfo","restrictedDepth","Float32Array","identity","Number","NEGATIVE_INFINITY","POSITIVE_INFINITY","kR","kRG","kRGBA","A","kBGRA","kFloat11Format","exponentBits","mantissaBits","bias","kFloat10Format","kFloat9e5Format","rgb10a2unorm","rg11b10ufloat","componentsBits","rgb9e5ufloat","parts","depth32float","Depth","depth16unorm","depth24plus","stencil8","Stencil","getSingleDataType","infos","cur","getComponentReadbackTraits","ReadbackTypedArray","shaderType","Int32Array"],"mappings":"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","sourcesContent":["import { assert, unreachable } from '../../../common/util/util.js';\nimport { EncodableTextureFormat, UncompressedTextureFormat } from '../../capability_info.js';\nimport {\n  assertInIntegerRange,\n  float32ToFloatBits,\n  float32ToFloat16Bits,\n  floatAsNormalizedInteger,\n  gammaCompress,\n  gammaDecompress,\n  normalizedIntegerAsFloat,\n  packRGB9E5UFloat,\n  floatBitsToNumber,\n  float16BitsToFloat32,\n  floatBitsToNormalULPFromZero,\n  kFloat32Format,\n  kFloat16Format,\n  numberToFloat32Bits,\n  float32BitsToNumber,\n  numberToFloatBits,\n} from '../conversion.js';\nimport { clamp, signExtend } from '../math.js';\n\n/** A component of a texture format: R, G, B, A, Depth, or Stencil. */\nexport const enum TexelComponent {\n  R = 'R',\n  G = 'G',\n  B = 'B',\n  A = 'A',\n  Depth = 'Depth',\n  Stencil = 'Stencil',\n}\n\n/** Arbitrary data, per component of a texel format. */\nexport type PerTexelComponent<T> = { [c in TexelComponent]?: T };\n\n/** How a component is encoded in its bit range of a texel format. */\nexport type ComponentDataType = 'uint' | 'sint' | 'unorm' | 'snorm' | 'float' | 'ufloat' | null;\n\n/**\n * Maps component values to component values\n * @param {PerTexelComponent<number>} components - The input components.\n * @returns {PerTexelComponent<number>} The new output components.\n */\ntype ComponentMapFn = (components: PerTexelComponent<number>) => PerTexelComponent<number>;\n\n/**\n * Packs component values as an ArrayBuffer\n * @param {PerTexelComponent<number>} components - The input components.\n * @returns {ArrayBuffer} The packed data.\n */\ntype ComponentPackFn = (components: PerTexelComponent<number>) => ArrayBuffer;\n\n/** Unpacks component values from a Uint8Array */\ntype ComponentUnpackFn = (data: Uint8Array) => PerTexelComponent<number>;\n\n/**\n * Create a PerTexelComponent object filled with the same value for all components.\n * @param {TexelComponent[]} components - The component names.\n * @param {T} value - The value to assign to each component.\n * @returns {PerTexelComponent<T>}\n */\nfunction makePerTexelComponent<T>(components: TexelComponent[], value: T): PerTexelComponent<T> {\n  const values: PerTexelComponent<T> = {};\n  for (const c of components) {\n    values[c] = value;\n  }\n  return values;\n}\n\n/**\n * Create a function which applies clones a `PerTexelComponent<number>` and then applies the\n * function `fn` to each component of `components`.\n * @param {(value: number) => number} fn - The mapping function to apply to component values.\n * @param {TexelComponent[]} components - The component names.\n * @returns {ComponentMapFn} The map function which clones the input component values, and applies\n *                           `fn` to each of component of `components`.\n */\nfunction applyEach(fn: (value: number) => number, components: TexelComponent[]): ComponentMapFn {\n  return (values: PerTexelComponent<number>) => {\n    values = Object.assign({}, values);\n    for (const c of components) {\n      assert(values[c] !== undefined);\n      values[c] = fn(values[c]!);\n    }\n    return values;\n  };\n}\n\n/**\n * A `ComponentMapFn` for encoding sRGB.\n * @param {PerTexelComponent<number>} components - The input component values.\n * @returns {TexelComponent<number>} Gamma-compressed copy of `components`.\n */\nconst encodeSRGB: ComponentMapFn = components => {\n  assert(\n    components.R !== undefined && components.G !== undefined && components.B !== undefined,\n    'sRGB requires all of R, G, and B components'\n  );\n  return applyEach(gammaCompress, kRGB)(components);\n};\n\n/**\n * A `ComponentMapFn` for decoding sRGB.\n * @param {PerTexelComponent<number>} components - The input component values.\n * @returns {TexelComponent<number>} Gamma-decompressed copy of `components`.\n */\nconst decodeSRGB: ComponentMapFn = components => {\n  components = Object.assign({}, components);\n  assert(\n    components.R !== undefined && components.G !== undefined && components.B !== undefined,\n    'sRGB requires all of R, G, and B components'\n  );\n  return applyEach(gammaDecompress, kRGB)(components);\n};\n\n/**\n * Makes a `ComponentMapFn` for clamping values to the specified range.\n */\nexport function makeClampToRange(format: EncodableTextureFormat): ComponentMapFn {\n  const repr = kTexelRepresentationInfo[format];\n  assert(repr.numericRange !== null, 'Format has unknown numericRange');\n  return applyEach(x => clamp(x, repr.numericRange!), repr.componentOrder);\n}\n\n// MAINTENANCE_TODO: Look into exposing this map to the test fixture so that it can be GCed at the\n// end of each test group. That would allow for caching of larger buffers (though it's unclear how\n// ofter larger buffers are used by packComponents.)\nconst smallComponentDataViews = new Map();\nfunction getComponentDataView(byteLength: number): DataView {\n  if (byteLength > 32) {\n    const buffer = new ArrayBuffer(byteLength);\n    return new DataView(buffer);\n  }\n  let dataView = smallComponentDataViews.get(byteLength);\n  if (!dataView) {\n    const buffer = new ArrayBuffer(byteLength);\n    dataView = new DataView(buffer);\n    smallComponentDataViews.set(byteLength, dataView);\n  }\n  return dataView;\n}\n\n/**\n * Helper function to pack components as an ArrayBuffer.\n * @param {TexelComponent[]} componentOrder - The order of the component data.\n * @param {PerTexelComponent<number>} components - The input component values.\n * @param {number | PerTexelComponent<number>} bitLengths - The length in bits of each component.\n *   If a single number, all components are the same length, otherwise this is a dictionary of\n *   per-component bit lengths.\n * @param {ComponentDataType | PerTexelComponent<ComponentDataType>} componentDataTypes -\n *   The type of the data in `components`. If a single value, all components have the same value.\n *   Otherwise, this is a dictionary of per-component data types.\n * @returns {ArrayBuffer} The packed component data.\n */\nfunction packComponents(\n  componentOrder: TexelComponent[],\n  components: PerTexelComponent<number>,\n  bitLengths: number | PerTexelComponent<number>,\n  componentDataTypes: ComponentDataType | PerTexelComponent<ComponentDataType>\n): ArrayBuffer {\n  let bitLengthMap;\n  let totalBitLength;\n  if (typeof bitLengths === 'number') {\n    bitLengthMap = makePerTexelComponent(componentOrder, bitLengths);\n    totalBitLength = bitLengths * componentOrder.length;\n  } else {\n    bitLengthMap = bitLengths;\n    totalBitLength = Object.entries(bitLengthMap).reduce((acc, [, value]) => {\n      assert(value !== undefined);\n      return acc + value;\n    }, 0);\n  }\n  assert(totalBitLength % 8 === 0);\n\n  const componentDataTypeMap =\n    typeof componentDataTypes === 'string' || componentDataTypes === null\n      ? makePerTexelComponent(componentOrder, componentDataTypes)\n      : componentDataTypes;\n\n  const dataView = getComponentDataView(totalBitLength / 8);\n  let bitOffset = 0;\n  for (const c of componentOrder) {\n    const value = components[c];\n    const type = componentDataTypeMap[c];\n    const bitLength = bitLengthMap[c];\n    assert(value !== undefined);\n    assert(type !== undefined);\n    assert(bitLength !== undefined);\n\n    const byteOffset = Math.floor(bitOffset / 8);\n    const byteLength = Math.ceil(bitLength / 8);\n    switch (type) {\n      case 'uint':\n      case 'unorm':\n        if (byteOffset === bitOffset / 8 && byteLength === bitLength / 8) {\n          switch (byteLength) {\n            case 1:\n              dataView.setUint8(byteOffset, value);\n              break;\n            case 2:\n              dataView.setUint16(byteOffset, value, true);\n              break;\n            case 4:\n              dataView.setUint32(byteOffset, value, true);\n              break;\n            default:\n              unreachable();\n          }\n        } else {\n          // Packed representations are all 32-bit and use Uint as the data type.\n          // ex.) rg10b11float, rgb10a2unorm\n          switch (dataView.byteLength) {\n            case 4: {\n              const currentValue = dataView.getUint32(0, true);\n\n              let mask = 0xffffffff;\n              const bitsToClearRight = bitOffset;\n              const bitsToClearLeft = 32 - (bitLength + bitOffset);\n\n              mask = (mask >>> bitsToClearRight) << bitsToClearRight;\n              mask = (mask << bitsToClearLeft) >>> bitsToClearLeft;\n\n              const newValue = (currentValue & ~mask) | (value << bitOffset);\n\n              dataView.setUint32(0, newValue, true);\n              break;\n            }\n            default:\n              unreachable();\n          }\n        }\n        break;\n      case 'sint':\n      case 'snorm':\n        assert(byteOffset === bitOffset / 8 && byteLength === bitLength / 8);\n        switch (byteLength) {\n          case 1:\n            dataView.setInt8(byteOffset, value);\n            break;\n          case 2:\n            dataView.setInt16(byteOffset, value, true);\n            break;\n          case 4:\n            dataView.setInt32(byteOffset, value, true);\n            break;\n          default:\n            unreachable();\n        }\n        break;\n      case 'float':\n        assert(byteOffset === bitOffset / 8 && byteLength === bitLength / 8);\n        switch (byteLength) {\n          case 4:\n            dataView.setFloat32(byteOffset, value, true);\n            break;\n          default:\n            unreachable();\n        }\n        break;\n      case 'ufloat':\n      case null:\n        unreachable();\n    }\n\n    bitOffset += bitLength;\n  }\n\n  return dataView.buffer;\n}\n\n/**\n * Unpack substrings of bits from a Uint8Array, e.g. [8,8,8,8] or [9,9,9,5].\n */\nfunction unpackComponentsBits(\n  componentOrder: TexelComponent[],\n  byteView: Uint8Array,\n  bitLengths: number | PerTexelComponent<number>\n): PerTexelComponent<number> {\n  const components = makePerTexelComponent(componentOrder, 0);\n\n  let bitLengthMap;\n  let totalBitLength;\n  if (typeof bitLengths === 'number') {\n    let index = 0;\n    // Optimized cases for when the bit lengths are all a well aligned value.\n    switch (bitLengths) {\n      case 8:\n        for (const c of componentOrder) {\n          components[c] = byteView[index++];\n        }\n        return components;\n      case 16: {\n        const shortView = new Uint16Array(byteView.buffer, byteView.byteOffset);\n        for (const c of componentOrder) {\n          components[c] = shortView[index++];\n        }\n        return components;\n      }\n      case 32: {\n        const longView = new Uint32Array(byteView.buffer, byteView.byteOffset);\n        for (const c of componentOrder) {\n          components[c] = longView[index++];\n        }\n        return components;\n      }\n    }\n\n    bitLengthMap = makePerTexelComponent(componentOrder, bitLengths);\n    totalBitLength = bitLengths * componentOrder.length;\n  } else {\n    bitLengthMap = bitLengths;\n    totalBitLength = Object.entries(bitLengthMap).reduce((acc, [, value]) => {\n      assert(value !== undefined);\n      return acc + value;\n    }, 0);\n  }\n\n  assert(totalBitLength % 8 === 0);\n\n  const dataView = new DataView(byteView.buffer, byteView.byteOffset, byteView.byteLength);\n  let bitOffset = 0;\n  for (const c of componentOrder) {\n    const bitLength = bitLengthMap[c];\n    assert(bitLength !== undefined);\n\n    let value: number;\n\n    const byteOffset = Math.floor(bitOffset / 8);\n    const byteLength = Math.ceil(bitLength / 8);\n    if (byteOffset === bitOffset / 8 && byteLength === bitLength / 8) {\n      switch (byteLength) {\n        case 1:\n          value = dataView.getUint8(byteOffset);\n          break;\n        case 2:\n          value = dataView.getUint16(byteOffset, true);\n          break;\n        case 4:\n          value = dataView.getUint32(byteOffset, true);\n          break;\n        default:\n          unreachable();\n      }\n    } else {\n      // Packed representations are all 32-bit and use Uint as the data type.\n      // ex.) rg10b11float, rgb10a2unorm\n      assert(dataView.byteLength === 4);\n      const word = dataView.getUint32(0, true);\n      value = (word >>> bitOffset) & ((1 << bitLength) - 1);\n    }\n\n    bitOffset += bitLength;\n    components[c] = value;\n  }\n\n  return components;\n}\n\n/**\n * Create an entry in `kTexelRepresentationInfo` for normalized integer texel data with constant\n * bitlength.\n * @param {TexelComponent[]} componentOrder - The order of the component data.\n * @param {number} bitLength - The number of bits in each component.\n * @param {{signed: boolean; sRGB: boolean}} opt - Boolean flags for `signed` and `sRGB`.\n */\nfunction makeNormalizedInfo(\n  componentOrder: TexelComponent[],\n  bitLength: number,\n  opt: { signed: boolean; sRGB: boolean }\n): TexelRepresentationInfo {\n  const encodeNonSRGB = applyEach(\n    (n: number) => floatAsNormalizedInteger(n, bitLength, opt.signed),\n    componentOrder\n  );\n  const decodeNonSRGB = applyEach(\n    (n: number) => normalizedIntegerAsFloat(n, bitLength, opt.signed),\n    componentOrder\n  );\n\n  const numberToBitsNonSRGB = applyEach(\n    n => floatAsNormalizedInteger(n, bitLength, opt.signed),\n    componentOrder\n  );\n  let bitsToNumberNonSRGB: ComponentMapFn;\n  if (opt.signed) {\n    bitsToNumberNonSRGB = applyEach(\n      n => normalizedIntegerAsFloat(signExtend(n, bitLength), bitLength, opt.signed),\n      componentOrder\n    );\n  } else {\n    bitsToNumberNonSRGB = applyEach(\n      n => normalizedIntegerAsFloat(n, bitLength, opt.signed),\n      componentOrder\n    );\n  }\n\n  let encode: ComponentMapFn;\n  let decode: ComponentMapFn;\n  let numberToBits: ComponentMapFn;\n  let bitsToNumber: ComponentMapFn;\n  if (opt.sRGB) {\n    encode = components => encodeNonSRGB(encodeSRGB(components));\n    decode = components => decodeSRGB(decodeNonSRGB(components));\n    numberToBits = components => numberToBitsNonSRGB(encodeSRGB(components));\n    bitsToNumber = components => decodeSRGB(bitsToNumberNonSRGB(components));\n  } else {\n    encode = encodeNonSRGB;\n    decode = decodeNonSRGB;\n    numberToBits = numberToBitsNonSRGB;\n    bitsToNumber = bitsToNumberNonSRGB;\n  }\n\n  let bitsToULPFromZero: ComponentMapFn;\n  if (opt.signed) {\n    const maxValue = (1 << (bitLength - 1)) - 1; // e.g. 127 for snorm8\n    bitsToULPFromZero = applyEach(\n      n => Math.max(-maxValue, signExtend(n, bitLength)),\n      componentOrder\n    );\n  } else {\n    bitsToULPFromZero = components => components;\n  }\n\n  const dataType: ComponentDataType = opt.signed ? 'snorm' : 'unorm';\n  return {\n    componentOrder,\n    componentInfo: makePerTexelComponent(componentOrder, {\n      dataType,\n      bitLength,\n    }),\n    encode,\n    decode,\n    pack: (components: PerTexelComponent<number>) =>\n      packComponents(componentOrder, components, bitLength, dataType),\n    unpackBits: (data: Uint8Array) => unpackComponentsBits(componentOrder, data, bitLength),\n    numberToBits,\n    bitsToNumber,\n    bitsToULPFromZero,\n    numericRange: { min: opt.signed ? -1 : 0, max: 1 },\n  };\n}\n\n/**\n * Create an entry in `kTexelRepresentationInfo` for integer texel data with constant bitlength.\n * @param {TexelComponent[]} componentOrder - The order of the component data.\n * @param {number} bitLength - The number of bits in each component.\n * @param {{signed: boolean}} opt - Boolean flag for `signed`.\n */\nfunction makeIntegerInfo(\n  componentOrder: TexelComponent[],\n  bitLength: number,\n  opt: { signed: boolean }\n): TexelRepresentationInfo {\n  assert(bitLength <= 32);\n  const encode = applyEach(\n    (n: number) => (assertInIntegerRange(n, bitLength, opt.signed), n),\n    componentOrder\n  );\n  const decode = applyEach(\n    (n: number) => (assertInIntegerRange(n, bitLength, opt.signed), n),\n    componentOrder\n  );\n\n  let bitsToULPFromZero: ComponentMapFn;\n  if (opt.signed) {\n    bitsToULPFromZero = applyEach(n => signExtend(n, bitLength), componentOrder);\n  } else {\n    bitsToULPFromZero = components => components;\n  }\n\n  const dataType: ComponentDataType = opt.signed ? 'sint' : 'uint';\n  const bitMask = (1 << bitLength) - 1;\n  return {\n    componentOrder,\n    componentInfo: makePerTexelComponent(componentOrder, {\n      dataType,\n      bitLength,\n    }),\n    encode,\n    decode,\n    pack: (components: PerTexelComponent<number>) =>\n      packComponents(componentOrder, components, bitLength, dataType),\n    unpackBits: (data: Uint8Array) => unpackComponentsBits(componentOrder, data, bitLength),\n    numberToBits: applyEach(v => v & bitMask, componentOrder),\n    bitsToNumber: decode,\n    bitsToULPFromZero,\n    numericRange: opt.signed\n      ? { min: -(2 ** (bitLength - 1)), max: 2 ** (bitLength - 1) - 1 }\n      : { min: 0, max: 2 ** bitLength - 1 },\n  };\n}\n\n/**\n * Create an entry in `kTexelRepresentationInfo` for floating point texel data with constant\n * bitlength.\n * @param {TexelComponent[]} componentOrder - The order of the component data.\n * @param {number} bitLength - The number of bits in each component.\n */\nfunction makeFloatInfo(\n  componentOrder: TexelComponent[],\n  bitLength: number,\n  { restrictedDepth = false }: { restrictedDepth?: boolean } = {}\n): TexelRepresentationInfo {\n  let encode: ComponentMapFn;\n  let numberToBits;\n  let bitsToNumber;\n  let bitsToULPFromZero;\n  switch (bitLength) {\n    case 32:\n      if (restrictedDepth) {\n        encode = applyEach(v => {\n          assert(v >= 0.0 && v <= 1.0, 'depth out of range');\n          return new Float32Array([v])[0];\n        }, componentOrder);\n      } else {\n        encode = applyEach(v => new Float32Array([v])[0], componentOrder);\n      }\n      numberToBits = applyEach(numberToFloat32Bits, componentOrder);\n      bitsToNumber = applyEach(float32BitsToNumber, componentOrder);\n      bitsToULPFromZero = applyEach(\n        v => floatBitsToNormalULPFromZero(v, kFloat32Format),\n        componentOrder\n      );\n      break;\n    case 16:\n      if (restrictedDepth) {\n        encode = applyEach(v => {\n          assert(v >= 0.0 && v <= 1.0, 'depth out of range');\n          return float16BitsToFloat32(float32ToFloat16Bits(v));\n        }, componentOrder);\n      } else {\n        encode = applyEach(v => float16BitsToFloat32(float32ToFloat16Bits(v)), componentOrder);\n      }\n      numberToBits = applyEach(float32ToFloat16Bits, componentOrder);\n      bitsToNumber = applyEach(float16BitsToFloat32, componentOrder);\n      bitsToULPFromZero = applyEach(\n        v => floatBitsToNormalULPFromZero(v, kFloat16Format),\n        componentOrder\n      );\n      break;\n    default:\n      unreachable();\n  }\n  const decode = applyEach(identity, componentOrder);\n\n  return {\n    componentOrder,\n    componentInfo: makePerTexelComponent(componentOrder, {\n      dataType: 'float' as const,\n      bitLength,\n    }),\n    encode,\n    decode,\n    pack: (components: PerTexelComponent<number>) => {\n      switch (bitLength) {\n        case 16:\n          components = applyEach(float32ToFloat16Bits, componentOrder)(components);\n          return packComponents(componentOrder, components, 16, 'uint');\n        case 32:\n          return packComponents(componentOrder, components, bitLength, 'float');\n        default:\n          unreachable();\n      }\n    },\n    unpackBits: (data: Uint8Array) => unpackComponentsBits(componentOrder, data, bitLength),\n    numberToBits,\n    bitsToNumber,\n    bitsToULPFromZero,\n    numericRange: restrictedDepth\n      ? { min: 0, max: 1 }\n      : { min: Number.NEGATIVE_INFINITY, max: Number.POSITIVE_INFINITY },\n  };\n}\n\nconst kR = [TexelComponent.R];\nconst kRG = [TexelComponent.R, TexelComponent.G];\nconst kRGB = [TexelComponent.R, TexelComponent.G, TexelComponent.B];\nconst kRGBA = [TexelComponent.R, TexelComponent.G, TexelComponent.B, TexelComponent.A];\nconst kBGRA = [TexelComponent.B, TexelComponent.G, TexelComponent.R, TexelComponent.A];\n\nconst identity = (n: number) => n;\n\nconst kFloat11Format = { signed: 0, exponentBits: 5, mantissaBits: 6, bias: 15 } as const;\nconst kFloat10Format = { signed: 0, exponentBits: 5, mantissaBits: 5, bias: 15 } as const;\nconst kFloat9e5Format = { signed: 0, exponentBits: 5, mantissaBits: 9, bias: 15 } as const;\n\nexport type TexelRepresentationInfo = {\n  /** Order of components in the packed representation. */\n  readonly componentOrder: TexelComponent[];\n  /** Data type and bit length of each component in the format. */\n  readonly componentInfo: PerTexelComponent<{\n    dataType: ComponentDataType;\n    bitLength: number;\n  }>;\n  /** Encode shader values into their data representation. ex.) float 1.0 -> unorm8 255 */\n  // MAINTENANCE_TODO: Replace with numberToBits?\n  readonly encode: ComponentMapFn;\n  /** Decode the data representation into the shader values. ex.) unorm8 255 -> float 1.0 */\n  // MAINTENANCE_TODO: Replace with bitsToNumber?\n  readonly decode: ComponentMapFn;\n  /** Pack texel component values into an ArrayBuffer. ex.) rg8unorm `{r: 0, g: 255}` -> 0xFF00 */\n  // MAINTENANCE_TODO: Replace with packBits?\n  readonly pack: ComponentPackFn;\n\n  /** Convert integer bit representations into numeric values, e.g. unorm8 255 -> numeric 1.0 */\n  readonly bitsToNumber: ComponentMapFn;\n  /** Convert numeric values into integer bit representations, e.g. numeric 1.0 -> unorm8 255 */\n  readonly numberToBits: ComponentMapFn;\n  /** Unpack integer bit representations from an ArrayBuffer, e.g. 0xFF00 -> rg8unorm [0,255] */\n  readonly unpackBits: ComponentUnpackFn;\n  /** Convert integer bit representations into ULPs-from-zero, e.g. unorm8 255 -> 255 ULPs */\n  readonly bitsToULPFromZero: ComponentMapFn;\n  /** The valid range of numeric \"color\" values, e.g. [0, Infinity] for ufloat. */\n  readonly numericRange: null | { min: number; max: number };\n\n  // Add fields as needed\n};\nexport const kTexelRepresentationInfo: {\n  readonly [k in UncompressedTextureFormat]: TexelRepresentationInfo;\n} = {\n  .../* prettier-ignore */ {\n    'r8unorm':               makeNormalizedInfo(   kR,  8, { signed: false, sRGB: false }),\n    'r8snorm':               makeNormalizedInfo(   kR,  8, { signed:  true, sRGB: false }),\n    'r8uint':                makeIntegerInfo(      kR,  8, { signed: false }),\n    'r8sint':                makeIntegerInfo(      kR,  8, { signed:  true }),\n    'r16uint':               makeIntegerInfo(      kR, 16, { signed: false }),\n    'r16sint':               makeIntegerInfo(      kR, 16, { signed:  true }),\n    'r16float':              makeFloatInfo(        kR, 16),\n    'rg8unorm':              makeNormalizedInfo(  kRG,  8, { signed: false, sRGB: false }),\n    'rg8snorm':              makeNormalizedInfo(  kRG,  8, { signed:  true, sRGB: false }),\n    'rg8uint':               makeIntegerInfo(     kRG,  8, { signed: false }),\n    'rg8sint':               makeIntegerInfo(     kRG,  8, { signed:  true }),\n    'r32uint':               makeIntegerInfo(      kR, 32, { signed: false }),\n    'r32sint':               makeIntegerInfo(      kR, 32, { signed:  true }),\n    'r32float':              makeFloatInfo(        kR, 32),\n    'rg16uint':              makeIntegerInfo(     kRG, 16, { signed: false }),\n    'rg16sint':              makeIntegerInfo(     kRG, 16, { signed:  true }),\n    'rg16float':             makeFloatInfo(       kRG, 16),\n    'rgba8unorm':            makeNormalizedInfo(kRGBA,  8, { signed: false, sRGB: false }),\n    'rgba8unorm-srgb':       makeNormalizedInfo(kRGBA,  8, { signed: false, sRGB:  true }),\n    'rgba8snorm':            makeNormalizedInfo(kRGBA,  8, { signed:  true, sRGB: false }),\n    'rgba8uint':             makeIntegerInfo(   kRGBA,  8, { signed: false }),\n    'rgba8sint':             makeIntegerInfo(   kRGBA,  8, { signed:  true }),\n    'bgra8unorm':            makeNormalizedInfo(kBGRA,  8, { signed: false, sRGB: false }),\n    'bgra8unorm-srgb':       makeNormalizedInfo(kBGRA,  8, { signed: false, sRGB:  true }),\n    'rg32uint':              makeIntegerInfo(     kRG, 32, { signed: false }),\n    'rg32sint':              makeIntegerInfo(     kRG, 32, { signed:  true }),\n    'rg32float':             makeFloatInfo(       kRG, 32),\n    'rgba16uint':            makeIntegerInfo(   kRGBA, 16, { signed: false }),\n    'rgba16sint':            makeIntegerInfo(   kRGBA, 16, { signed:  true }),\n    'rgba16float':           makeFloatInfo(     kRGBA, 16),\n    'rgba32uint':            makeIntegerInfo(   kRGBA, 32, { signed: false }),\n    'rgba32sint':            makeIntegerInfo(   kRGBA, 32, { signed:  true }),\n    'rgba32float':           makeFloatInfo(     kRGBA, 32),\n  },\n  ...{\n    rgb10a2unorm: {\n      componentOrder: kRGBA,\n      componentInfo: {\n        R: { dataType: 'unorm', bitLength: 10 },\n        G: { dataType: 'unorm', bitLength: 10 },\n        B: { dataType: 'unorm', bitLength: 10 },\n        A: { dataType: 'unorm', bitLength: 2 },\n      },\n      encode: components => {\n        return {\n          R: floatAsNormalizedInteger(components.R ?? unreachable(), 10, false),\n          G: floatAsNormalizedInteger(components.G ?? unreachable(), 10, false),\n          B: floatAsNormalizedInteger(components.B ?? unreachable(), 10, false),\n          A: floatAsNormalizedInteger(components.A ?? unreachable(), 2, false),\n        };\n      },\n      decode: components => {\n        return {\n          R: normalizedIntegerAsFloat(components.R ?? unreachable(), 10, false),\n          G: normalizedIntegerAsFloat(components.G ?? unreachable(), 10, false),\n          B: normalizedIntegerAsFloat(components.B ?? unreachable(), 10, false),\n          A: normalizedIntegerAsFloat(components.A ?? unreachable(), 2, false),\n        };\n      },\n      pack: components =>\n        packComponents(\n          kRGBA,\n          components,\n          {\n            R: 10,\n            G: 10,\n            B: 10,\n            A: 2,\n          },\n          'uint'\n        ),\n      unpackBits: (data: Uint8Array) =>\n        unpackComponentsBits(kRGBA, data, { R: 10, G: 10, B: 10, A: 2 }),\n      numberToBits: components => ({\n        R: floatAsNormalizedInteger(components.R ?? unreachable(), 10, false),\n        G: floatAsNormalizedInteger(components.G ?? unreachable(), 10, false),\n        B: floatAsNormalizedInteger(components.B ?? unreachable(), 10, false),\n        A: floatAsNormalizedInteger(components.A ?? unreachable(), 2, false),\n      }),\n      bitsToNumber: components => ({\n        R: normalizedIntegerAsFloat(components.R!, 10, false),\n        G: normalizedIntegerAsFloat(components.G!, 10, false),\n        B: normalizedIntegerAsFloat(components.B!, 10, false),\n        A: normalizedIntegerAsFloat(components.A!, 2, false),\n      }),\n      bitsToULPFromZero: components => components,\n      numericRange: { min: 0, max: 1 },\n    },\n    rg11b10ufloat: {\n      componentOrder: kRGB,\n      encode: applyEach(identity, kRGB),\n      decode: applyEach(identity, kRGB),\n      componentInfo: {\n        R: { dataType: 'ufloat', bitLength: 11 },\n        G: { dataType: 'ufloat', bitLength: 11 },\n        B: { dataType: 'ufloat', bitLength: 10 },\n      },\n      pack: components => {\n        const componentsBits = {\n          R: float32ToFloatBits(components.R ?? unreachable(), 0, 5, 6, 15),\n          G: float32ToFloatBits(components.G ?? unreachable(), 0, 5, 6, 15),\n          B: float32ToFloatBits(components.B ?? unreachable(), 0, 5, 5, 15),\n        };\n        return packComponents(\n          kRGB,\n          componentsBits,\n          {\n            R: 11,\n            G: 11,\n            B: 10,\n          },\n          'uint'\n        );\n      },\n      unpackBits: (data: Uint8Array) => unpackComponentsBits(kRGB, data, { R: 11, G: 11, B: 10 }),\n      numberToBits: components => ({\n        R: numberToFloatBits(components.R ?? unreachable(), kFloat11Format),\n        G: numberToFloatBits(components.G ?? unreachable(), kFloat11Format),\n        B: numberToFloatBits(components.B ?? unreachable(), kFloat10Format),\n      }),\n      bitsToNumber: components => ({\n        R: floatBitsToNumber(components.R!, kFloat11Format),\n        G: floatBitsToNumber(components.G!, kFloat11Format),\n        B: floatBitsToNumber(components.B!, kFloat10Format),\n      }),\n      bitsToULPFromZero: components => ({\n        R: floatBitsToNormalULPFromZero(components.R!, kFloat11Format),\n        G: floatBitsToNormalULPFromZero(components.G!, kFloat11Format),\n        B: floatBitsToNormalULPFromZero(components.B!, kFloat10Format),\n      }),\n      numericRange: { min: 0, max: Number.POSITIVE_INFINITY },\n    },\n    rgb9e5ufloat: {\n      componentOrder: kRGB,\n      componentInfo: makePerTexelComponent(kRGB, {\n        dataType: 'ufloat',\n        bitLength: -1, // Components don't really have a bitLength since the format is packed.\n      }),\n      encode: applyEach(identity, kRGB),\n      decode: applyEach(identity, kRGB),\n      pack: components =>\n        new Uint32Array([\n          packRGB9E5UFloat(\n            components.R ?? unreachable(),\n            components.G ?? unreachable(),\n            components.B ?? unreachable()\n          ),\n        ]).buffer,\n      // For the purpose of unpacking, expand into three \"ufloat14\" values.\n      unpackBits: (data: Uint8Array) => {\n        // Pretend the exponent part is A so we can use unpackComponentsBits.\n        const parts = unpackComponentsBits(kRGBA, data, { R: 9, G: 9, B: 9, A: 5 });\n        return {\n          R: (parts.A! << 9) | parts.R!,\n          G: (parts.A! << 9) | parts.G!,\n          B: (parts.A! << 9) | parts.B!,\n        };\n      },\n      numberToBits: components => ({\n        R: float32ToFloatBits(components.R ?? unreachable(), 0, 5, 9, 15),\n        G: float32ToFloatBits(components.G ?? unreachable(), 0, 5, 9, 15),\n        B: float32ToFloatBits(components.B ?? unreachable(), 0, 5, 9, 15),\n      }),\n      bitsToNumber: components => ({\n        R: floatBitsToNumber(components.R!, kFloat9e5Format),\n        G: floatBitsToNumber(components.G!, kFloat9e5Format),\n        B: floatBitsToNumber(components.B!, kFloat9e5Format),\n      }),\n      bitsToULPFromZero: components => ({\n        R: floatBitsToNormalULPFromZero(components.R!, kFloat9e5Format),\n        G: floatBitsToNormalULPFromZero(components.G!, kFloat9e5Format),\n        B: floatBitsToNormalULPFromZero(components.B!, kFloat9e5Format),\n      }),\n      numericRange: { min: 0, max: Number.POSITIVE_INFINITY },\n    },\n    depth32float: makeFloatInfo([TexelComponent.Depth], 32, { restrictedDepth: true }),\n    depth16unorm: makeNormalizedInfo([TexelComponent.Depth], 16, { signed: false, sRGB: false }),\n    depth24plus: {\n      componentOrder: [TexelComponent.Depth],\n      componentInfo: { Depth: { dataType: null, bitLength: 24 } },\n      encode: applyEach(() => unreachable('depth24plus cannot be encoded'), [TexelComponent.Depth]),\n      decode: applyEach(() => unreachable('depth24plus cannot be decoded'), [TexelComponent.Depth]),\n      pack: () => unreachable('depth24plus data cannot be packed'),\n      unpackBits: () => unreachable('depth24plus data cannot be unpacked'),\n      numberToBits: () => unreachable('depth24plus has no representation'),\n      bitsToNumber: () => unreachable('depth24plus has no representation'),\n      bitsToULPFromZero: () => unreachable('depth24plus has no representation'),\n      numericRange: { min: 0, max: 1 },\n    },\n    stencil8: makeIntegerInfo([TexelComponent.Stencil], 8, { signed: false }),\n    'depth32float-stencil8': {\n      componentOrder: [TexelComponent.Depth, TexelComponent.Stencil],\n      componentInfo: {\n        Depth: {\n          dataType: 'float',\n          bitLength: 32,\n        },\n        Stencil: {\n          dataType: 'uint',\n          bitLength: 8,\n        },\n      },\n      encode: components => {\n        assert(components.Stencil !== undefined);\n        assertInIntegerRange(components.Stencil, 8, false);\n        return components;\n      },\n      decode: components => {\n        assert(components.Stencil !== undefined);\n        assertInIntegerRange(components.Stencil, 8, false);\n        return components;\n      },\n      pack: () => unreachable('depth32float-stencil8 data cannot be packed'),\n      unpackBits: () => unreachable('depth32float-stencil8 data cannot be unpacked'),\n      numberToBits: () => unreachable('not implemented'),\n      bitsToNumber: () => unreachable('not implemented'),\n      bitsToULPFromZero: () => unreachable('not implemented'),\n      numericRange: null,\n    },\n    'depth24plus-stencil8': {\n      componentOrder: [TexelComponent.Depth, TexelComponent.Stencil],\n      componentInfo: {\n        Depth: {\n          dataType: null,\n          bitLength: 24,\n        },\n        Stencil: {\n          dataType: 'uint',\n          bitLength: 8,\n        },\n      },\n      encode: components => {\n        assert(components.Depth === undefined, 'depth24plus cannot be encoded');\n        assert(components.Stencil !== undefined);\n        assertInIntegerRange(components.Stencil, 8, false);\n        return components;\n      },\n      decode: components => {\n        assert(components.Depth === undefined, 'depth24plus cannot be decoded');\n        assert(components.Stencil !== undefined);\n        assertInIntegerRange(components.Stencil, 8, false);\n        return components;\n      },\n      pack: () => unreachable('depth24plus-stencil8 data cannot be packed'),\n      unpackBits: () => unreachable('depth24plus-stencil8 data cannot be unpacked'),\n      numberToBits: () => unreachable('depth24plus-stencil8 has no representation'),\n      bitsToNumber: () => unreachable('depth24plus-stencil8 has no representation'),\n      bitsToULPFromZero: () => unreachable('depth24plus-stencil8 has no representation'),\n      numericRange: null,\n    },\n  },\n};\n\n/**\n * Get the `ComponentDataType` for a format. All components must have the same type.\n * @param {UncompressedTextureFormat} format - The input format.\n * @returns {ComponentDataType} The data of the components.\n */\nexport function getSingleDataType(format: UncompressedTextureFormat): ComponentDataType {\n  const infos = Object.values(kTexelRepresentationInfo[format].componentInfo);\n  assert(infos.length > 0);\n  return infos.reduce((acc, cur) => {\n    assert(cur !== undefined);\n    assert(acc === undefined || acc === cur.dataType);\n    return cur.dataType;\n  }, infos[0]!.dataType);\n}\n\n/**\n *  Get traits for generating code to readback data from a component.\n * @param {ComponentDataType} dataType - The input component data type.\n * @returns A dictionary containing the respective `ReadbackTypedArray` and `shaderType`.\n */\nexport function getComponentReadbackTraits(dataType: ComponentDataType) {\n  switch (dataType) {\n    case 'ufloat':\n    case 'float':\n    case 'unorm':\n    case 'snorm':\n      return {\n        ReadbackTypedArray: Float32Array,\n        shaderType: 'f32' as const,\n      };\n    case 'uint':\n      return {\n        ReadbackTypedArray: Uint32Array,\n        shaderType: 'u32' as const,\n      };\n    case 'sint':\n      return {\n        ReadbackTypedArray: Int32Array,\n        shaderType: 'i32' as const,\n      };\n    default:\n      unreachable();\n  }\n}\n"],"file":"texel_data.js"}