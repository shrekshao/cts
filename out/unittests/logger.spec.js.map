{"version":3,"sources":["../../src/unittests/logger.spec.ts"],"names":["description","SkipTestCase","makeTestGroup","Logger","assert","UnitTest","g","test","fn","t","mylog","overrideDebugMode","res1","record","res2","expect","results","get","logs","undefined","status","timems","rec","res","start","finish","debug","Error","skipped","warn","expectationFailed","validationFailed","threw","paramsSimple","_logsCount","params","length"],"mappings":"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","sourcesContent":["export const description = `\nUnit tests for namespaced logging system.\n\nAlso serves as a larger test of async test functions, and of the logging system.\n`;\n\nimport { SkipTestCase } from '../common/framework/fixture.js';\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { Logger } from '../common/internal/logging/logger.js';\nimport { assert } from '../common/util/util.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = makeTestGroup(UnitTest);\n\ng.test('construct').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [, res1] = mylog.record('one');\n  const [, res2] = mylog.record('two');\n\n  t.expect(mylog.results.get('one') === res1);\n  t.expect(mylog.results.get('two') === res2);\n  t.expect(res1.logs === undefined);\n  t.expect(res1.status === 'running');\n  t.expect(res1.timems < 0);\n  t.expect(res2.logs === undefined);\n  t.expect(res2.status === 'running');\n  t.expect(res2.timems < 0);\n});\n\ng.test('empty').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('pass').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.debug(new Error('hello'));\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('skip').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.skipped(new SkipTestCase());\n  rec.debug(new Error('hello'));\n  rec.finish();\n\n  t.expect(res.status === 'skip');\n  t.expect(res.timems >= 0);\n});\n\ng.test('warn').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.warn(new Error('hello'));\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'warn');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,expectationFailed').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.expectationFailed(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,validationFailed').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.validationFailed(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,threw').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.threw(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('debug')\n  .paramsSimple([\n    { debug: true, _logsCount: 5 }, //\n    { debug: false, _logsCount: 3 },\n  ])\n  .fn(t => {\n    const { debug, _logsCount } = t.params;\n\n    const mylog = new Logger({ overrideDebugMode: debug });\n    const [rec, res] = mylog.record('one');\n\n    rec.start();\n    rec.debug(new Error('hello'));\n    rec.expectationFailed(new Error('bye'));\n    rec.warn(new Error());\n    rec.skipped(new SkipTestCase());\n    rec.debug(new Error('foo'));\n    rec.finish();\n\n    t.expect(res.status === 'fail');\n    t.expect(res.timems >= 0);\n    assert(res.logs !== undefined);\n    t.expect(res.logs.length === _logsCount);\n  });\n"],"file":"logger.spec.js"}