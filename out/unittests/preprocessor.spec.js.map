{"version":3,"sources":["../../src/unittests/preprocessor.spec.ts"],"names":["description","makeTestGroup","pp","UnitTest","F","test","act","exp","expect","replace","g","fn","t","_if","_endif","_else","_elif","__if","__endif","__elif","__else","e","shouldThrow"],"mappings":"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","sourcesContent":["export const description = `\nTest for \"pp\" preprocessor.\n`;\n\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { pp } from '../common/util/preprocessor.js';\n\nimport { UnitTest } from './unit_test.js';\n\nclass F extends UnitTest {\n  test(act: string, exp: string): void {\n    this.expect(act === exp, 'got: ' + act.replace('\\n', '⏎'));\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('empty').fn(t => {\n  t.test(pp``, '');\n  t.test(pp`\\n`, '\\n');\n  t.test(pp`\\n\\n`, '\\n\\n');\n});\n\ng.test('plain').fn(t => {\n  t.test(pp`a`, 'a');\n  t.test(pp`\\na`, '\\na');\n  t.test(pp`\\n\\na`, '\\n\\na');\n  t.test(pp`\\na\\n`, '\\na\\n');\n  t.test(pp`a\\n\\n`, 'a\\n\\n');\n});\n\ng.test('substitutions,1').fn(t => {\n  const act = pp`a ${3} b`;\n  const exp = 'a 3 b';\n  t.test(act, exp);\n});\n\ng.test('substitutions,2').fn(t => {\n  const act = pp`a ${'x'}`;\n  const exp = 'a x';\n  t.test(act, exp);\n});\n\ng.test('substitutions,3').fn(t => {\n  const act = pp`a ${'x'} b`;\n  const exp = 'a x b';\n  t.test(act, exp);\n});\n\ng.test('substitutions,4').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\n${'x'}\n${pp._endif}\nb`;\n  const exp = '\\na\\n\\nb';\n  t.test(act, exp);\n});\n\ng.test('if,true').fn(t => {\n  const act = pp`\na\n${pp._if(true)}c${pp._endif}\nd\n`;\n  const exp = '\\na\\nc\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('if,false').fn(t => {\n  const act = pp`\na\n${pp._if(false)}c${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('else,1').fn(t => {\n  const act = pp`\na\n${pp._if(true)}\nb\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nb\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('else,2').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nc\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('elif,1').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp._elif(true)}\ne\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\ne\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('elif,2').fn(t => {\n  const act = pp`\na\n${pp._if(true)}\nb\n${pp._elif(true)}\ne\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nb\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('nested,1').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp.__if(true)}\ne\n${pp.__endif}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('nested,2').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp._else}\nh\n${pp.__if(false)}\ne\n${pp.__elif(true)}\nf\n${pp.__else}\ng\n${pp.__endif}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nh\\n\\nf\\n\\nc\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('errors,pass').fn(() => {\n  pp`${pp._if(true)}${pp._endif}`;\n  pp`${pp._if(true)}${pp._else}${pp._endif}`;\n  pp`${pp._if(true)}${pp.__if(true)}${pp.__endif}${pp._endif}`;\n});\n\ng.test('errors,fail').fn(t => {\n  const e = (fn: () => void) => t.shouldThrow('Error', fn);\n  e(() => pp`${pp._if(true)}`);\n  e(() => pp`${pp._elif(true)}`);\n  e(() => pp`${pp._else}`);\n  e(() => pp`${pp._endif}`);\n  e(() => pp`${pp.__if(true)}`);\n  e(() => pp`${pp.__elif(true)}`);\n  e(() => pp`${pp.__else}`);\n  e(() => pp`${pp.__endif}`);\n\n  e(() => pp`${pp._if(true)}${pp._elif(true)}`);\n  e(() => pp`${pp._if(true)}${pp._elif(true)}${pp._else}`);\n  e(() => pp`${pp._if(true)}${pp._else}`);\n  e(() => pp`${pp._else}${pp._endif}`);\n\n  e(() => pp`${pp._if(true)}${pp.__endif}`);\n  e(() => pp`${pp.__if(true)}${pp.__endif}`);\n  e(() => pp`${pp.__if(true)}${pp._endif}`);\n\n  e(() => pp`${pp._if(true)}${pp._else}${pp._else}${pp._endif}`);\n  e(() => pp`${pp._if(true)}${pp.__if(true)}${pp.__else}${pp.__else}${pp.__endif}${pp._endif}`);\n});\n"],"file":"preprocessor.spec.js"}